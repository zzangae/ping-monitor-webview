<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping ì‘ë‹µ í™•ì¸ ì‹œê°í™” ë„êµ¬ v2.7</title>
    <link rel="stylesheet" href="/web/css/variables.css">
    <link rel="stylesheet" href="/web/css/base.css">
    <link rel="stylesheet" href="/web/css/components.css">
    <link rel="stylesheet" href="/web/css/dashboard.css">
    <link rel="stylesheet" href="/web/css/notifications.css">
    <link rel="stylesheet" href="/web/css/outages.css">
    <link rel="stylesheet" href="/web/css/settings.css">
    <link rel="stylesheet" href="/web/css/responsive.css">
    <link rel="stylesheet" href="/web/config/settings.css">
    <link rel="stylesheet" href="/web/section-ip/timeline.css">
    <link rel="stylesheet" href="/web/minwin-ip/minwin-ip.css">
    <script src="/web/chart.umd.min.js"></script>
    <script src="/web/section-ip/timeline.js"></script>
    <script src="/web/config/settings.js"></script>
    <script src="/web/minwin-ip/minwin-ip.js"></script>
    <style>
        
        /* IP ì¹´ë“œ ê·¸ë¦¬ë“œ - ì›ë³¸ flex ë ˆì´ì•„ì›ƒ */
        .ip-grid {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 16px !important;
        }
        
        /* IP ì¹´ë“œ ë°˜ì‘í˜• ë„ˆë¹„ */
        .ip-card:not(.minimized) {
            flex: 1 1 280px !important;
            min-width: 280px !important;
            max-width: calc(20% - 13px) !important;  /* 5ê°œ ê¸°ì¤€ */
        }
        
        /* í™”ë©´ í¬ê¸°ë³„ ì¹´ë“œ ìµœëŒ€ ë„ˆë¹„ ì¡°ì • */
        @media (max-width: 1600px) {
            .ip-card:not(.minimized) {
                max-width: calc(25% - 12px) !important;  /* 4ê°œ */
            }
        }
        
        @media (max-width: 1200px) {
            .ip-card:not(.minimized) {
                max-width: calc(33.333% - 11px) !important;  /* 3ê°œ */
            }
        }
        
        @media (max-width: 900px) {
            .ip-card:not(.minimized) {
                max-width: calc(50% - 8px) !important;  /* 2ê°œ */
            }
        }
        
        @media (max-width: 600px) {
            .ip-card:not(.minimized) {
                max-width: 100% !important;  /* 1ê°œ */
            }
        }
        
        /* ìµœì†Œí™” ê´€ë ¨ ìŠ¤íƒ€ì¼ì€ minwin-ip.cssë¡œ ì´ë™ë¨ */
        
        /* ìµœì†Œí™”ëœ IP ì¹´ë“œ ìŠ¤íƒ€ì¼ (ì¸ë¼ì¸ ë³´ê°•) */
        .ip-card.minimized {
            width: auto !important;
            min-width: 80px !important;
            max-width: 120px !important;
            padding: 8px !important;
            padding-bottom: 12px !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
        }
        
        .ip-card.minimized .ip-header {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            width: 100% !important;
        }
        
        .ip-card.minimized .ip-header > div:first-child {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            order: 1 !important;
        }
        
        .ip-card.minimized .ip-name {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            color: #e4e6eb !important;
            font-size: 11px !important;
            font-weight: 600 !important;
            text-align: center !important;
            margin-top: 4px !important;
            max-width: 100px !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }
        
        /* IP ì£¼ì†Œ í‘œì‹œ */
        .ip-card.minimized .ip-address {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            color: #b0b3b8 !important;
            font-size: 9px !important;
            text-align: center !important;
            margin-top: 2px !important;
            max-width: 100px !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }
        
        .ip-card.minimized .chart-container,
        .ip-card.minimized .stats-row,
        .ip-card.minimized .packet-bars {
            display: none !important;
        }
        
        .ip-card.minimized .status-badge {
            display: inline-block !important;
            margin-top: 6px !important;
            font-size: 10px !important;
        }
        
        .ip-card.minimized .card-actions {
            order: 0 !important;
            margin-bottom: 4px !important;
        }
        
        .ip-card.minimized .card-minimize-btn {
            display: none !important;
        }
        
        .ip-card.minimized .card-restore-btn {
            display: inline-flex !important;
        }
        
        .ip-card.minimized .card-expand-btn {
            display: none !important;
        }
        
        /* ìµœì†Œí™”ëœ IP ì˜ì—­ ì¹´ìš´íŠ¸ ë°°ì§€ */
        .minimized-count {
            background: #6c5ce7 !important;
            color: white !important;
            padding: 2px 10px !important;
            border-radius: 12px !important;
            font-size: 12px !important;
            font-weight: bold !important;
            display: inline-block !important;
        }
        
        /* ëª¨ë‹¬ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        .modal.active {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        /* íƒ€ì„ë¼ì¸ ì‹œê°„ ë²”ìœ„ ë¼ë²¨ */
        #timelineRangeLabel {
            color: var(--primary);
            font-weight: 500;
            margin-left: 4px;
        }
        
        /* í™˜ê²½ì„¤ì • ëª¨ë‹¬ í•˜ë‹¨ ì €ì¥ ë²„íŠ¼ */
        .settings-footer {
            padding: 16px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .settings-footer .btn {
            min-width: 100px;
        }
        
        /* ê¸°ì¤€ ì‹œê°„ ì…ë ¥ + ìŠ¬ë¼ì´ë” ê·¸ë£¹ */
        .threshold-input-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .threshold-input-group .settings-input {
            width: 100px;
            flex-shrink: 0;
        }
        
        .threshold-input-group .threshold-slider {
            flex: 1;
        }
        
        /* í…Œì´ë¸” ë‚´ ìŠ¬ë¼ì´ë” */
        .threshold-table input[type="range"] {
            width: 100%;
            min-width: 80px;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #3a3f5c, #4a5080);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .threshold-table input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4), 0 0 4px rgba(255, 215, 0, 0.5);
        }
        
        .threshold-table input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.25);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .threshold-table input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4), 0 0 4px rgba(255, 215, 0, 0.5);
        }
        
        /* ê¸°ë³¸ ê¸°ì¤€ ì‹œê°„ìš© ìŠ¬ë¼ì´ë” */
        .threshold-slider {
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #3a3f5c, #4a5080);
            border-radius: 4px;
            outline: none;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .threshold-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4), 0 0 4px rgba(255, 215, 0, 0.5);
        }
        
        .threshold-slider::-webkit-slider-thumb:hover {
            transform: scale(1.25);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .threshold-slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4), 0 0 4px rgba(255, 215, 0, 0.5);
        }
        
        /* ì•ŒëŒ ì„¤ì • ìŠ¤íƒ€ì¼ */
        .settings-checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 8px;
        }
        
        .settings-checkbox-label:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .settings-checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }
        
        .settings-checkbox-label span {
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .settings-select {
            flex: 1;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
        }
        
        .settings-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .settings-select option {
            background: #2d3250;
            color: var(--text-primary);
        }
        
        .alarm-threshold-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        /* ì•ŒëŒ í‘œì‹œê¸° */
        .alarm-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #ff4757, #ff6b6b);
            color: white;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(255, 71, 87, 0.5);
            z-index: 10000;
            display: none;
            animation: alarmPulse 1s infinite;
        }
        
        .alarm-indicator.active {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @keyframes alarmPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }
        
        .alarm-indicator .alarm-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
        }
        
        .alarm-indicator .alarm-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .modal-content {
            max-height: 85vh;
            overflow: hidden;
        }
        
        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* ìµœìƒë‹¨ í—¤ë” - ê³ ì • í•´ì œ ë° ë†’ì´ ìµœì†Œí™” */
        .header {
            position: relative !important;
            padding: 8px 20px !important;
            min-height: auto !important;
        }
        
        .header h1 {
            font-size: 1.2rem !important;
            margin: 0 !important;
        }
        
        .header-subtitle {
            font-size: 0.75rem !important;
            margin-top: 2px !important;
        }
    </style>

</head>
<body>
    <!-- ì•ŒëŒ í‘œì‹œê¸° -->
    <div class="alarm-indicator" id="alarmIndicator">
        <span>ğŸ””</span>
        <span id="alarmMessage">ë¯¸ì‘ë‹µ ì•ŒëŒ</span>
        <button class="alarm-close" id="alarmClose">Ã—</button>
    </div>
    <!-- Header -->
    <div class="header" id="mainHeader">
        <h1>ğŸŒ Ping ì‘ë‹µ í™•ì¸ ì‹œê°í™” ë„êµ¬ v2.7</h1>
        <div class="header-subtitle">ë‹¤ìˆ˜ì˜ IPì— ëŒ€í•œ ping ì‘ë‹µ ê²°ê³¼ë¥¼ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤</div>
    </div>

    <!-- Tab Navigation -->
        <div class="container">
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab-btn" data-tab="notifications">ğŸ”” ì•Œë¦¼ ê¸°ë¡</button>
            <button class="tab-btn" data-tab="outages">ğŸ“‹ ë¯¸ì‘ë‹µ ê¸°ë¡</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <!-- Unified Control Bar -->
            <div class="unified-control-bar">
                <!-- Time Info -->
                <div class="control-group">
                    <div class="time-display">
                        <div class="time-label">í˜„ì¬ ì‹œê°„</div>
                        <div class="time-value large" id="currentTime">00:00:00</div>
                    </div>
                    <div class="time-display">
                        <div class="time-label">í˜„ì¬ ë‚ ì§œ</div>
                        <div class="time-value" id="currentDate">0000-00-00</div>
                    </div>
                    <div class="time-display">
                        <div class="time-label">ì‹¤í–‰ ì‹œê°„</div>
                        <div class="time-value" id="uptime">00:00:00</div>
                    </div>
                </div>
                
                <div class="control-divider"></div>
                
                <!-- Tab & Control Buttons -->
                <div class="control-group">
                    <button type="button" class="btn btn-primary" id="toggleBtn">ì¼ì‹œì •ì§€</button>
                    <button type="button" class="btn btn-success" id="refreshBtn">ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div class="control-divider"></div>
                
                <!-- Stats -->
                <div class="control-group" style="flex: 1; justify-content: space-around;">
                    <div class="stat-item-inline">
                        <div class="stat-label">ì „ì²´ IP</div>
                        <div class="stat-value" id="totalIPs">0</div>
                    </div>
                    <div class="stat-item-inline">
                        <div class="stat-label">ì˜¨ë¼ì¸</div>
                        <div class="stat-value" style="color: var(--success);" id="onlineCount">0</div>
                    </div>
                    <div class="stat-item-inline">
                        <div class="stat-label">ì˜¤í”„ë¼ì¸</div>
                        <div class="stat-value" style="color: var(--error);" id="offlineCount">0</div>
                    </div>
                    <div class="stat-item-inline">
                        <div class="stat-label">í‰ê·  ì§€ì—°</div>
                        <div class="stat-value" id="avgLatency">0</div>
                    </div>
                </div>
                
                <div class="control-divider"></div>
                
                <!-- Sort Controls -->
                <div class="control-group">
                    <button class="card-sort-btn" id="sortByName">ì´ë¦„ìˆœ</button>
                    <button class="card-sort-btn" id="sortByLatency">ì§€ì—°ìˆœ</button>
                    <button class="card-sort-btn" id="sortByStatus">ìƒíƒœìˆœ</button>
                </div>
            </div>

            <!-- Comparison Chart -->
            <div class="card" id="comparisonChartCard">
                <div class="card-header">
                    <div class="card-title" id="timelineTitle">IP ë¹„êµ íƒ€ì„ë¼ì¸ <span id="timelineRangeLabel">(1ë¶„)</span></div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button class="chart-settings-btn" id="chartSettingsBtn" title="í™˜ê²½ì„¤ì •">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M12 1v6m0 6v6m5.2-13.2l-4.3 4.3M7.8 16.4l-4.3 4.3M23 12h-6m-6 0H1m17.8-5.2l-4.3 4.3M7.8 7.8L3.5 3.5"></path>
                            </svg>
                        </button>
                        <button class="minimize-btn" id="timelineMinimizeBtn" title="íƒ€ì„ë¼ì¸ ìµœì†Œí™”/í™•ëŒ€">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="18 15 12 9 6 15"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="collapsible-content" id="timelineContent">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Chart Settings Modal -->
            <div class="modal" id="chartSettingsModal">
                <div class="modal-content settings-modal-content">
                    <div class="modal-header">
                        <h3>í™˜ê²½ì„¤ì •</h3>
                        <button class="modal-close" id="closeChartSettings">&times;</button>
                    </div>
                    
                    <!-- Settings Tabs (ê³ ì •) -->
                    <div class="settings-tabs-row">
                        <button class="settings-tab-btn active" data-settings-tab="chart">
                            ğŸ“Š ì°¨íŠ¸ ì„¤ì •
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="timerange">
                            â±ï¸ ì‹œê°„ ë²”ìœ„
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="alarm">
                            ğŸ”” ì•ŒëŒ ì„¤ì •
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="thresholds">
                            ğŸ¯ ê·¸ë£¹ë³„ ì„¤ì •
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="ipgroups">
                            ğŸ“‹ IP ê·¸ë£¹ ê´€ë¦¬
                        </button>
                    </div>
                    
                    <div class="settings-success" id="settingsSuccess" style="margin: 0 20px 16px 20px;">
                        âœ“ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
                    </div>
                    
                    <!-- íƒ­ ë‚´ìš© ì˜ì—­ -->
                    <div class="settings-tab-container">
                
                <!-- Tab 1: ì°¨íŠ¸ ì„¤ì • (ê¸°ì¡´) -->
                <div class="settings-tab-content active" id="settings-chart">
                    <div class="chart-settings-controls">
                        <button class="btn btn-sm btn-secondary" id="selectAllIPs">ì „ì²´ ì„ íƒ</button>
                        <button class="btn btn-sm btn-secondary" id="deselectAllIPs">ì „ì²´ í•´ì œ</button>
                    </div>
                    <div class="settings-scroll-box" id="ipCheckboxList">
                        <!-- IP ì²´í¬ë°•ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <!-- Tab 2: ì‹œê°„ ë²”ìœ„ (v2.7) -->
                <div class="settings-tab-content" id="settings-timerange">
                    <div class="settings-scroll-box">
                        <div class="settings-section-title">
                            â±ï¸ íƒ€ì„ë¼ì¸ ì‹œê°„ ë²”ìœ„
                        </div>
                        <div class="settings-help" style="margin-bottom: 16px;">
                            IP ë¹„êµ íƒ€ì„ë¼ì¸ ì°¨íŠ¸ì— í‘œì‹œí•  ì‹œê°„ ë²”ìœ„ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
                        </div>
                        <div class="time-range-radio-group" id="timeRangeRadioGroup">
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="60">
                                <span class="radio-label">1ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="300">
                                <span class="radio-label">5ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="600">
                                <span class="radio-label">10ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="1800">
                                <span class="radio-label">30ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="3600">
                                <span class="radio-label">1ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="10800">
                                <span class="radio-label">3ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="18000">
                                <span class="radio-label">5ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="43200">
                                <span class="radio-label">12ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="86400">
                                <span class="radio-label">24ì‹œê°„</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 3: ì•ŒëŒ ì„¤ì • (v2.7) -->
                <div class="settings-tab-content" id="settings-alarm">
                    <div class="settings-scroll-box">
                        <div class="settings-section">
                            <div class="settings-section-title">
                                ğŸ”” ë¯¸ì‘ë‹µ ì•ŒëŒ ì„¤ì •
                            </div>
                            <div class="settings-help" style="margin-bottom: 16px;">
                                IPê°€ ì„¤ì •ëœ ì‹œê°„ ë™ì•ˆ ì‘ë‹µì´ ì—†ìœ¼ë©´ ì•ŒëŒì´ ìš¸ë¦½ë‹ˆë‹¤.
                            </div>
                            
                            <!-- ì•ŒëŒ í™œì„±í™” -->
                            <div class="settings-form-group">
                                <label class="settings-checkbox-label">
                                    <input type="checkbox" id="alarmEnabled" checked>
                                    <span>ì•ŒëŒ í™œì„±í™”</span>
                                </label>
                            </div>
                            
                            <!-- ì•ŒëŒ ì„ê³„ê°’ ì„¤ì • -->
                            <div class="settings-form-group">
                                <label class="settings-label">ì•ŒëŒ ë°œìƒ ì‹œê°„ (ì´ˆ)</label>
                                <div class="threshold-input-group">
                                    <input type="number" class="settings-input" id="alarmThreshold" 
                                           value="30" min="10" max="600" step="10">
                                    <input type="range" class="threshold-slider" id="alarmThreshold_slider"
                                           value="30" min="10" max="300" step="10">
                                </div>
                                <div class="settings-help">
                                    IPê°€ ì´ ì‹œê°„(ì´ˆ) ë™ì•ˆ ì‘ë‹µì´ ì—†ìœ¼ë©´ ì•ŒëŒì´ ìš¸ë¦½ë‹ˆë‹¤. (ê¸°ë³¸: 30ì´ˆ)
                                </div>
                            </div>
                            
                            <!-- ì•ŒëŒ ì†Œë¦¬ ì„ íƒ -->
                            <div class="settings-form-group">
                                <label class="settings-label">ì•ŒëŒ ì†Œë¦¬</label>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <select class="settings-select" id="alarmSound">
                                        <option value="beep">ê¸°ë³¸ ë¹„í”„ìŒ</option>
                                        <option value="alert">ê²½ê³ ìŒ</option>
                                        <option value="chime">ì°¨ì„ë²¨</option>
                                    </select>
                                    <button class="btn btn-sm btn-secondary" id="testAlarmSound">ğŸ”Š í…ŒìŠ¤íŠ¸</button>
                                </div>
                            </div>
                            
                            <!-- ì•ŒëŒ ë°˜ë³µ ì„¤ì • -->
                            <div class="settings-form-group">
                                <label class="settings-checkbox-label">
                                    <input type="checkbox" id="alarmRepeat">
                                    <span>ë¯¸ì‘ë‹µ ì§€ì† ì‹œ ë°˜ë³µ ì•ŒëŒ (30ì´ˆ ê°„ê²©)</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <div class="settings-section-title">
                                ğŸ“‹ ë¯¸ì‘ë‹µ ê¸°ë¡ ì„ê³„ê°’
                            </div>
                            <div class="settings-help" style="margin-bottom: 16px;">
                                ì„¤ì •ëœ ì‹œê°„ ì´ìƒ ë¯¸ì‘ë‹µ ì‹œ ë¯¸ì‘ë‹µ ê¸°ë¡ íƒ­ì— ìë™ ê¸°ë¡ë©ë‹ˆë‹¤.
                            </div>
                            
                            <div class="alarm-threshold-list">
                                <label class="settings-checkbox-label">
                                    <input type="checkbox" id="record30s" checked>
                                    <span>30ì´ˆ ì´ìƒ ë¯¸ì‘ë‹µ ì‹œ ê¸°ë¡</span>
                                </label>
                                <label class="settings-checkbox-label">
                                    <input type="checkbox" id="record1m" checked>
                                    <span>1ë¶„ ì´ìƒ ë¯¸ì‘ë‹µ ì‹œ ê¸°ë¡</span>
                                </label>
                                <label class="settings-checkbox-label">
                                    <input type="checkbox" id="record3m" checked>
                                    <span>3ë¶„ ì´ìƒ ë¯¸ì‘ë‹µ ì‹œ ê¸°ë¡</span>
                                </label>
                                <label class="settings-checkbox-label">
                                    <input type="checkbox" id="record5m">
                                    <span>5ë¶„ ì´ìƒ ë¯¸ì‘ë‹µ ì‹œ ê¸°ë¡</span>
                                </label>
                                <label class="settings-checkbox-label">
                                    <input type="checkbox" id="record10m">
                                    <span>10ë¶„ ì´ìƒ ë¯¸ì‘ë‹µ ì‹œ ê¸°ë¡</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 4: ê·¸ë£¹ë³„ ì„¤ì • -->
                <div class="settings-tab-content" id="settings-thresholds">
                    <div class="settings-scroll-box">
                        <!-- Content -->
                        <div id="thresholdContent">
                            <div class="settings-section">
                                <div class="settings-section-title">
                                    âš¡ ê¸°ë³¸ ì„¤ì •
                                </div>
                                <div class="settings-form-group">
                                    <label class="settings-label">ë¯¸ì‘ë‹µ ê¸°ë¡ ê¸°ì¤€ ì‹œê°„ (ì´ˆ)</label>
                                    <div class="threshold-input-group">
                                        <input type="number" class="settings-input" id="defaultThreshold" 
                                               value="300" min="30" max="3600" step="10"
                                               oninput="syncThresholdSlider('defaultThreshold')">
                                        <input type="range" class="threshold-slider" id="defaultThreshold_slider"
                                               value="300" min="30" max="600" step="10"
                                               oninput="syncThresholdInput('defaultThreshold')">
                                    </div>
                                    <div class="settings-help">
                                        IPê°€ ì´ ì‹œê°„(ì´ˆ) ë™ì•ˆ ì‘ë‹µì´ ì—†ìœ¼ë©´ ë¯¸ì‘ë‹µìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤. (ê¸°ë³¸: 300ì´ˆ = 5ë¶„)
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <div class="settings-section-title">
                                    ğŸ“Š ê·¸ë£¹ë³„ ì»¤ìŠ¤í…€ ì„¤ì •
                                </div>
                                <table class="threshold-table">
                                    <thead>
                                        <tr>
                                            <th>ê·¸ë£¹</th>
                                            <th>ê¸°ì¤€ ì‹œê°„ (ì´ˆ)</th>
                                            <th>ìŠ¬ë¼ì´ë”</th>
                                            <th>ì„¤ëª…</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>ğŸ–¥ï¸ ì„œë²„</td>
                                            <td><input type="number" id="thresh_ì„œë²„" value="180" min="30" max="3600" step="10" oninput="syncThresholdSlider('thresh_ì„œë²„')"></td>
                                            <td><input type="range" id="thresh_ì„œë²„_slider" value="180" min="30" max="600" step="10" oninput="syncThresholdInput('thresh_ì„œë²„')"></td>
                                            <td class="settings-help">ì„œë²„: 3ë¶„ (180ì´ˆ)</td>
                                        </tr>
                                        <tr>
                                            <td>ğŸŒ ë„¤íŠ¸ì›Œí¬</td>
                                            <td><input type="number" id="thresh_ë„¤íŠ¸ì›Œí¬" value="300" min="30" max="3600" step="10" oninput="syncThresholdSlider('thresh_ë„¤íŠ¸ì›Œí¬')"></td>
                                            <td><input type="range" id="thresh_ë„¤íŠ¸ì›Œí¬_slider" value="300" min="30" max="600" step="10" oninput="syncThresholdInput('thresh_ë„¤íŠ¸ì›Œí¬')"></td>
                                            <td class="settings-help">ë„¤íŠ¸ì›Œí¬: 5ë¶„ (300ì´ˆ)</td>
                                        </tr>
                                        <tr>
                                            <td>ğŸ›¡ï¸ ë°©í™”ë²½</td>
                                            <td><input type="number" id="thresh_ë°©í™”ë²½" value="120" min="30" max="3600" step="10" oninput="syncThresholdSlider('thresh_ë°©í™”ë²½')"></td>
                                            <td><input type="range" id="thresh_ë°©í™”ë²½_slider" value="120" min="30" max="600" step="10" oninput="syncThresholdInput('thresh_ë°©í™”ë²½')"></td>
                                            <td class="settings-help">ë°©í™”ë²½: 2ë¶„ (120ì´ˆ)</td>
                                        </tr>
                                        <tr>
                                            <td>ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤</td>
                                            <td><input type="number" id="thresh_ë°ì´í„°ë² ì´ìŠ¤" value="180" min="30" max="3600" step="10" oninput="syncThresholdSlider('thresh_ë°ì´í„°ë² ì´ìŠ¤')"></td>
                                            <td><input type="range" id="thresh_ë°ì´í„°ë² ì´ìŠ¤_slider" value="180" min="30" max="600" step="10" oninput="syncThresholdInput('thresh_ë°ì´í„°ë² ì´ìŠ¤')"></td>
                                            <td class="settings-help">ë°ì´í„°ë² ì´ìŠ¤: 3ë¶„ (180ì´ˆ)</td>
                                        </tr>
                                        <tr>
                                            <td>ğŸŒ ì›¹ì„œë²„</td>
                                            <td><input type="number" id="thresh_ì›¹ì„œë²„" value="240" min="30" max="3600" step="10" oninput="syncThresholdSlider('thresh_ì›¹ì„œë²„')"></td>
                                            <td><input type="range" id="thresh_ì›¹ì„œë²„_slider" value="240" min="30" max="600" step="10" oninput="syncThresholdInput('thresh_ì›¹ì„œë²„')"></td>
                                            <td class="settings-help">ì›¹ì„œë²„: 4ë¶„ (240ì´ˆ)</td>
                                        </tr>
                                        <tr>
                                            <td>ğŸ“¦ ìŠ¤í† ë¦¬ì§€</td>
                                            <td><input type="number" id="thresh_ìŠ¤í† ë¦¬ì§€" value="300" min="30" max="3600" step="10" oninput="syncThresholdSlider('thresh_ìŠ¤í† ë¦¬ì§€')"></td>
                                            <td><input type="range" id="thresh_ìŠ¤í† ë¦¬ì§€_slider" value="300" min="30" max="600" step="10" oninput="syncThresholdInput('thresh_ìŠ¤í† ë¦¬ì§€')"></td>
                                            <td class="settings-help">ìŠ¤í† ë¦¬ì§€: 5ë¶„ (300ì´ˆ)</td>
                                        </tr>
                                        <tr>
                                            <td>ğŸ”§ ê¸°íƒ€</td>
                                            <td><input type="number" id="thresh_ê¸°íƒ€" value="300" min="30" max="3600" step="10" oninput="syncThresholdSlider('thresh_ê¸°íƒ€')"></td>
                                            <td><input type="range" id="thresh_ê¸°íƒ€_slider" value="300" min="30" max="600" step="10" oninput="syncThresholdInput('thresh_ê¸°íƒ€')"></td>
                                            <td class="settings-help">ê¸°íƒ€: 5ë¶„ (300ì´ˆ)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 4: IP ê·¸ë£¹ ê´€ë¦¬ -->
                <div class="settings-tab-content" id="settings-ipgroups">
                    <div class="settings-scroll-box">
                        <!-- Empty State Guide -->
                        <div id="ipgroupEmptyState" class="empty-state" style="display: block;">
                            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ·ï¸</div>
                            <h3 style="font-size: 20px; margin-bottom: 12px; color: var(--text-primary);">IP ê·¸ë£¹ ë° ìš°ì„ ìˆœìœ„ ê´€ë¦¬</h3>
                            <p style="font-size: 14px; line-height: 1.6; max-width: 500px; margin: 0 auto;">
                                í™•ì¸ ì¤‘ì¸ IPë¥¼ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜í•˜ê³  ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                                ìš°ì„ ìˆœìœ„ 1ì´ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤.<br><br>
                                <strong>ê·¸ë£¹ ì¢…ë¥˜:</strong> ì„œë²„, ë„¤íŠ¸ì›Œí¬, ë°©í™”ë²½, ë°ì´í„°ë² ì´ìŠ¤, ì›¹ì„œë²„, ìŠ¤í† ë¦¬ì§€, ê¸°íƒ€
                            </p>
                        </div>
                        
                        <!-- Content -->
                        <div id="ipgroupContent" style="display: none;">
                            <div class="settings-section">
                                <div class="settings-section-title">
                                    ğŸ·ï¸ IPë³„ ê·¸ë£¹ ë° ìš°ì„ ìˆœìœ„
                                </div>
                                <div class="settings-help" style="margin-bottom: 16px;">
                                    ê° IPì˜ ê·¸ë£¹ê³¼ ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ìš°ì„ ìˆœìœ„ 1ì´ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤.
                                </div>
                                <table class="ip-config-table" id="ipConfigTable">
                                    <thead>
                                        <tr>
                                            <th>IP ì£¼ì†Œ</th>
                                            <th>ì´ë¦„</th>
                                            <th>ê·¸ë£¹</th>
                                            <th>ìš°ì„ ìˆœìœ„ (1-5)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ipConfigTableBody">
                                        <!-- Dynamically populated -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                    </div><!-- settings-tab-container -->
                    
                    <!-- ê³µí†µ ì €ì¥ ë²„íŠ¼ -->
                    <div class="settings-footer">
                        <button class="btn btn-primary" id="saveAllSettings">ğŸ’¾ ì €ì¥</button>
                    </div>
                </div><!-- modal-content -->
            </div><!-- modal -->

            <!-- Minimized Cards Area -->
            <div id="minimizedCardsArea" class="minimized-cards-area" style="display: none;">
                <div class="minimized-area-header">
                    <span class="minimized-area-title">ğŸ“¦ ìµœì†Œí™”ëœ IP</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="minimized-count" id="minimizedCount">0</span>
                        <button class="minimize-btn" id="minimizedAreaMinimizeBtn" title="ìµœì†Œí™”ëœ IP ì˜ì—­ ìµœì†Œí™”/í™•ëŒ€">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="18 15 12 9 6 15"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="collapsible-content" id="minimizedAreaContent">
                    <div id="minimizedCardsContainer" class="minimized-cards-container"></div>
                </div>
            </div>

            <!-- IP Cards -->
            <div id="ipCardsContainer" class="ip-grid"></div>
        </div>

        <!-- Notifications Tab -->
        <div class="tab-content" id="notifications">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì „ì²´ ì•Œë¦¼</div>
                    <div class="stat-value" id="notifTotalCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">íƒ€ì„ì•„ì›ƒ</div>
                    <div class="stat-value" style="color: var(--error);" id="notifTimeoutCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ë³µêµ¬</div>
                    <div class="stat-value" style="color: var(--success);" id="notifRecoveryCount">0</div>
                </div>
            </div>

            <!-- Notification Log -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ì•Œë¦¼ ê¸°ë¡</div>
                </div>
                
                <div class="filter-bar">
                    <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                    <button class="filter-btn" data-filter="timeout">íƒ€ì„ì•„ì›ƒë§Œ</button>
                    <button class="filter-btn" data-filter="recovery">ë³µêµ¬ë§Œ</button>
                </div>

                <div class="notification-list" id="notificationList">
                    <div class="loading">ì•Œë¦¼ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 class="modal-title" id="modalTitle">IP ìƒì„¸ ì •ë³´</h2>
                    <p id="modalSubtitle" style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;"></p>
                </div>
                <button class="modal-close" id="modalClose">Ã—</button>
            </div>
            <div class="modal-body">
                <!-- Stats -->
                <div class="modal-stats">
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">í˜„ì¬ ì§€ì—°ì‹œê°„</div>
                        <div class="modal-stat-value" id="modalLatency">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">ìµœì†Œ</div>
                        <div class="modal-stat-value" style="color: var(--success);" id="modalMin">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">í‰ê· </div>
                        <div class="modal-stat-value" style="color: var(--info);" id="modalAvg">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">ìµœëŒ€</div>
                        <div class="modal-stat-value" style="color: var(--error);" id="modalMax">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">íŒ¨í‚· ì†ì‹¤ë¥ </div>
                        <div class="modal-stat-value" id="modalLoss">0%</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">ìƒíƒœ</div>
                        <div class="modal-stat-value" id="modalStatus">ì˜¤í”„ë¼ì¸</div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="modal-chart-container">
                    <canvas id="modalChart"></canvas>
                </div>

                <!-- Details -->
                <div class="modal-details">
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ì´ ìš”ì²­</div>
                        <div class="modal-detail-value" id="modalTotal">0</div>
                    </div>
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ì„±ê³µ</div>
                        <div class="modal-detail-value" style="color: var(--success);" id="modalSuccess">0</div>
                    </div>
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ì‹¤íŒ¨</div>
                        <div class="modal-detail-value" style="color: var(--error);" id="modalFailed">0</div>
                    </div>
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ë§ˆì§€ë§‰ ì‘ë‹µ ì‹œê°„</div>
                        <div class="modal-detail-value" id="modalLastResponse">--:--:--</div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <script>
        // Global State
        let isRunning = true;
        let updateInterval;
        let timeInterval;
        // comparisonChart - timeline.jsì—ì„œ ê´€ë¦¬
        let ipCharts = {};
        let currentData = null;
        let draggedElement = null;
        let draggedIndex = null;
        let startTime = Date.now();
        let pausedElapsed = 0;
        let pausedTime = 0;
        let modalChart = null;
        let currentModalTarget = null;
        
        // visibleIPs - timeline.jsì—ì„œ ê´€ë¦¬
        // extendedHistory - timeline.jsì—ì„œ ê´€ë¦¬
        // selectedTimeRange - timeline.jsì—ì„œ ê´€ë¦¬
        // MAX_HISTORY_POINTS - timeline.jsì—ì„œ ê´€ë¦¬
        // brightColors - timeline.jsì—ì„œ ê´€ë¦¬
        
        // Notification State
        let allNotifications = [];
        let currentFilter = 'all';
        let allOutages = [];
        let currentOutageFilter = {status: 'all', group: 'all'};
        
        // Alarm State (v2.7)
        let alarmSettings = {
            enabled: true,
            threshold: 30,          // ì•ŒëŒ ë°œìƒ ì‹œê°„ (ì´ˆ)
            sound: 'beep',          // ì•ŒëŒ ì†Œë¦¬ ì¢…ë¥˜
            repeat: false,          // ë°˜ë³µ ì•ŒëŒ
            recordThresholds: {     // ë¯¸ì‘ë‹µ ê¸°ë¡ ì„ê³„ê°’
                sec30: true,
                min1: true,
                min3: true,
                min5: false,
                min10: false
            }
        };
        let ipOfflineTimers = {};   // IPë³„ ì˜¤í”„ë¼ì¸ ì‹œì‘ ì‹œê°„
        let alarmActive = false;    // í˜„ì¬ ì•ŒëŒ í™œì„± ìƒíƒœ
        let alarmRepeatInterval = null;  // ë°˜ë³µ ì•ŒëŒ ì¸í„°ë²Œ
        let audioContext = null;    // Web Audio API ì»¨í…ìŠ¤íŠ¸

        // DOMì´ ì¤€ë¹„ëœ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Initialize timeline (from timeline.js)
            initTimelineEvents();
            loadTimelineRange();
            
            // Initialize minimized area (from minwin-ip.js)
            initMinimizedAreaEvents();
            
            // Initialize alarm settings
            initAlarmSettings();
            
            // Initialize charts and data
            initComparisonChart();
            loadData();
            startUpdates();
            
            // Start time updates
            updateTime();
            timeInterval = setInterval(updateTime, 1000);
        });

        // ë¸Œë¼ìš°ì € ì¢…ë£Œ ê°ì§€
        let isRefreshing = false;
        
        window.addEventListener('beforeunload', function(e) {
            // ìƒˆë¡œê³ ì¹¨ì¸ì§€ í™•ì¸
            if (performance.navigation.type === 1) {
                isRefreshing = true;
                return;
            }
            
            // ë¸Œë¼ìš°ì € ë‹«ê¸° ì‹œ ì„œë²„ ì¢…ë£Œ ìš”ì²­
            if (!isRefreshing) {
                navigator.sendBeacon('/shutdown');
            }
        });

        function initializeEventListeners() {
            // Timeline Range Radio Buttons - settings.jsë¡œ ì´ë™ë¨
            // Timeline Minimize Button - timeline.jsì˜ initTimelineEvents()ë¡œ ì´ë™ë¨
            // Minimized Area Minimize Button - minwin-ip.jsì˜ initMinimizedAreaEvents()ë¡œ ì´ë™ë¨

            // Control Buttons
            const toggleBtn = document.getElementById('toggleBtn');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    isRunning = !isRunning;
                    toggleBtn.textContent = isRunning ? 'ì¼ì‹œì •ì§€' : 'ì‹œì‘';
                    toggleBtn.className = isRunning ? 'btn btn-primary' : 'btn btn-success';
                    
                    if (isRunning) {
                        startUpdates();
                        if (pausedTime > 0) {
                            const pauseDuration = Date.now() - pausedTime;
                            startTime += pauseDuration;
                            pausedTime = 0;
                        }
                    } else {
                        stopUpdates();
                        pausedTime = Date.now();
                    }
                });
            }

            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const originalText = refreshBtn.textContent;
                    
                    try {
                        refreshBtn.textContent = 'ìƒˆë¡œê³ ì¹¨ ì¤‘...';
                        refreshBtn.disabled = true;
                        
                        startTime = Date.now();
                        pausedTime = 0;
                        pausedElapsed = 0;
                        updateTime();
                        
                        // íƒ€ì„ë¼ì¸ ì°¨íŠ¸ ë¦¬ì…‹ (timeline.js)
                        resetComparisonChart();
                        
                        Object.keys(ipCharts).forEach(key => {
                            if (ipCharts[key]) {
                                ipCharts[key].destroy();
                            }
                        });
                        ipCharts = {};
                        
                        const ipCardsContainer = document.getElementById('ipCardsContainer');
                        if (ipCardsContainer) {
                            ipCardsContainer.innerHTML = '';
                        }
                        
                        const minimizedCardsContainer = document.getElementById('minimizedCardsContainer');
                        if (minimizedCardsContainer) {
                            minimizedCardsContainer.innerHTML = '';
                        }
                        const minimizedCardsArea = document.getElementById('minimizedCardsArea');
                        if (minimizedCardsArea) {
                            minimizedCardsArea.style.display = 'none';
                        }
                        
                        await loadData();
                        
                        const notificationTab = document.getElementById('notifications');
                        if (notificationTab && notificationTab.classList.contains('active')) {
                            await loadNotifications();
                        }
                    } catch (error) {
                        console.error('ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                    } finally {
                        refreshBtn.textContent = originalText;
                        refreshBtn.disabled = false;
                    }
                });
            }

            // Sort Buttons
            const sortByName = document.getElementById('sortByName');
            const sortByLatency = document.getElementById('sortByLatency');
            const sortByStatus = document.getElementById('sortByStatus');
            
            if (sortByName) sortByName.addEventListener('click', () => sortIPCards('name'));
            if (sortByLatency) sortByLatency.addEventListener('click', () => sortIPCards('latency'));
            if (sortByStatus) sortByStatus.addEventListener('click', () => sortIPCards('status'));

            // Modal Buttons
            const modalCloseBtn = document.getElementById('modalClose');
            const detailModal = document.getElementById('detailModal');
            
            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', closeDetailModal);
            }
            
            if (detailModal) {
                detailModal.addEventListener('click', (e) => {
                    if (e.target.id === 'detailModal') {
                        closeDetailModal();
                    }
                });
            }

            // Tab Buttons
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    btn.classList.add('active');
                    const targetId = btn.getAttribute('data-tab');
                    const targetContent = document.getElementById(targetId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                    
                    if (targetId === 'notifications') {
                        loadNotifications();
                    } else if (targetId === 'outages') {
                        loadOutages();
                    }
                });
            });

            // Notification Filter Buttons
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.getAttribute('data-filter');
                    renderNotifications();
                });
            });

            // Chart Settings Modal - settings.jsë¡œ ì´ë™ë¨
        }

        // Load saved header state

        // Save/Load visible IPs state - settings.jsë¡œ ì´ë™ë¨
        // saveMinimizedState, loadMinimizedState - minwin-ip.jsë¡œ ì´ë™ë¨

        // Time Update Functions
        function updateTime() {
            const now = new Date();
            
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}:${seconds}`;
            
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            document.getElementById('currentDate').textContent = `${year}-${month}-${day}`;
            
            let elapsed;
            if (!isRunning && pausedTime > 0) {
                elapsed = Math.floor((pausedTime - startTime) / 1000);
            } else {
                elapsed = Math.floor((Date.now() - startTime) / 1000);
            }
            
            const uptimeHours = Math.floor(elapsed / 3600);
            const uptimeMinutes = Math.floor((elapsed % 3600) / 60);
            const uptimeSeconds = elapsed % 60;
            document.getElementById('uptime').textContent = 
                `${String(uptimeHours).padStart(2, '0')}:${String(uptimeMinutes).padStart(2, '0')}:${String(uptimeSeconds).padStart(2, '0')}`;
        }

        // initComparisonChart - timeline.jsë¡œ ì´ë™ë¨

        function createIPChart(canvasId, index) {
            const ctx = document.getElementById(canvasId);
            const color = brightColors[index % brightColors.length];
            
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(60).fill(''),
                    datasets: [{
                        label: 'Latency (ms)',
                        data: [],
                        borderColor: color,
                        backgroundColor: color + '30',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2,
                        pointRadius: 0,      // ì  ë¹„í™œì„±í™” (ì„±ëŠ¥ í–¥ìƒ)
                        pointHoverRadius: 3  // í˜¸ë²„ ì‹œì—ë§Œ ì  í‘œì‹œ
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    normalized: true,        // ë°ì´í„° ì •ê·œí™” (ì„±ëŠ¥ í–¥ìƒ)
                    spanGaps: true,          // null ê°’ ê±´ë„ˆë›°ê¸°
                    plugins: {
                        legend: { display: false },
                        decimation: {         // ë°ì´í„° ê°„ì†Œí™” (ì„±ëŠ¥ í–¥ìƒ)
                            enabled: true,
                            algorithm: 'lttb'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#3a3f5c' },
                            ticks: { color: '#b0b3b8' }
                        },
                        x: {
                            display: false
                        }
                    },
                    elements: {
                        line: {
                            borderJoinStyle: 'round'  // ë¶€ë“œëŸ¬ìš´ ì„  ì—°ê²°
                        }
                    }
                }
            });
        }

        // Load Data
        async function loadData() {
            try {
                const response = await fetch('/data/ping_data.json?t=' + Date.now());
                const data = await response.json();
                currentData = data;
                updateUI(data);
                
                // ì„±ê³µ ì‹œê°„ ê¸°ë¡
                lastSuccessfulUpdate = Date.now();
                updateErrorCount = 0;
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                updateErrorCount++;
                
                // ì—°ì† 10íšŒ ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ì‹œë„
                if (updateErrorCount >= 10) {
                    console.warn('ì—°ì† ë¡œë“œ ì‹¤íŒ¨ - ë³µêµ¬ ì‹œë„');
                    recoverSystem();
                    updateErrorCount = 0;
                }
            }
        }

        // Update UI
        let lastIPChartReset = Date.now();
        
        function updateUI(data) {
            try {
                if (!data || !data.targets) return;
                
                const now = Date.now();
                
                // 12ì‹œê°„ë§ˆë‹¤ IP ì¹´ë“œ ì°¨íŠ¸ ì¬ìƒì„±
                const hoursSinceIPChartReset = (now - lastIPChartReset) / (1000 * 60 * 60);
                if (hoursSinceIPChartReset >= 12) {
                    console.log('12ì‹œê°„ ê²½ê³¼ - IP ì¹´ë“œ ì°¨íŠ¸ ì¬ìƒì„±');
                    Object.keys(ipCharts).forEach(key => {
                        if (ipCharts[key]) {
                            try { ipCharts[key].destroy(); } catch(e) {}
                        }
                    });
                    ipCharts = {};
                    
                    const ipCardsContainer = document.getElementById('ipCardsContainer');
                    if (ipCardsContainer) {
                        ipCardsContainer.innerHTML = '';
                    }
                    lastIPChartReset = now;
                }

                // ì €ì¥ëœ í•„í„° ìƒíƒœ ë¡œë“œ ë˜ëŠ” ì´ˆê¸°í™”
                if (visibleIPs.size === 0) {
                    const loaded = loadVisibleIPsState();
                    if (!loaded) {
                        data.targets.forEach((_, index) => visibleIPs.add(index));
                    }
                }

                // Update global stats
                const onlineCount = data.targets.filter(t => t.online).length;
                const offlineCount = data.targets.length - onlineCount;
                const avgLatency = Math.round(
                    data.targets.reduce((sum, t) => sum + (t.online ? t.latency : 0), 0) / 
                    (onlineCount || 1)
                );

                document.getElementById('totalIPs').textContent = data.targets.length;
                document.getElementById('onlineCount').textContent = onlineCount;
                document.getElementById('offlineCount').textContent = offlineCount;
                document.getElementById('avgLatency').textContent = avgLatency + ' ms';

                // Update comparison chart
                updateComparisonChart(data.targets);

                // Update IP cards
                updateIPCards(data.targets);
                
                // Load minimized state (only first time)
                if (Object.keys(ipCharts).length === data.targets.length) {
                    loadMinimizedState();
                }
                
                // Update modal if open
                updateModalIfOpen();
                
                // ì˜¤í”„ë¼ì¸ ìƒíƒœ ì²´í¬ ë° ì•ŒëŒ (v2.7)
                checkOfflineStatus(data.targets);
            } catch (error) {
                console.error('UI ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        // updateComparisonChart - timeline.jsë¡œ ì´ë™ë¨
        // generateTimeLabels - timeline.jsë¡œ ì´ë™ë¨
        // getDisplayData - timeline.jsë¡œ ì´ë™ë¨

        // Chart Settings Functions - settings.jsë¡œ ì´ë™ë¨

        // Update IP Cards
        function updateIPCards(targets) {
            const container = document.getElementById('ipCardsContainer');
            
            targets.forEach((target, index) => {
                let card = document.getElementById(`ip-card-${index}`);
                
                if (!card) {
                    card = createIPCard(target, index);
                    container.appendChild(card);
                    ipCharts[index] = createIPChart(`chart-${index}`, index);
                }
                
                updateIPCard(card, target, index);
            });
        }

        // Create IP Card
        function createIPCard(target, index) {
            const card = document.createElement('div');
            card.id = `ip-card-${index}`;
            card.className = 'ip-card';
            card.draggable = true;
            card.dataset.index = index;
            
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragover', handleDragOver);
            card.addEventListener('drop', handleDrop);
            card.addEventListener('dragend', handleDragEnd);
            
            card.innerHTML = `
                <div class="ip-header">
                    <div>
                        <div class="ip-name">${target.name}</div>
                        <div class="ip-address">${target.ip}</div>
                    </div>
                    <div class="card-actions">
                        <button class="card-action-btn card-minimize-btn" onclick="toggleMinimize(${index})" title="ìµœì†Œí™”">âˆ’</button>
                        <button class="card-action-btn card-restore-btn" onclick="toggleMinimize(${index})" title="ë³µì›">+</button>
                        <button class="card-action-btn card-expand-btn" onclick="openDetailModal(${index})" title="ìƒì„¸ë³´ê¸°">âŠ•</button>
                    </div>
                </div>
                <span class="status-badge" id="status-${index}">ì˜¤í”„ë¼ì¸</span>
                <div class="chart-container">
                    <canvas id="chart-${index}"></canvas>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-item-label">ì§€ì—°ì‹œê°„</div>
                        <div class="stat-item-value" id="latency-${index}">0 ms</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">ìµœì†Œ</div>
                        <div class="stat-item-value" id="min-${index}">0 ms</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">í‰ê· </div>
                        <div class="stat-item-value" id="avg-${index}">0 ms</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">ìµœëŒ€</div>
                        <div class="stat-item-value" id="max-${index}">0 ms</div>
                    </div>
                </div>
                <div class="packet-bars" id="packets-${index}"></div>
            `;
            return card;
        }

        // Drag & Drop Handlers
        function handleDragStart(e) {
            draggedElement = this;
            draggedIndex = parseInt(this.dataset.index);
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedElement !== this) {
                const container = document.getElementById('ipCardsContainer');
                const allCards = [...container.children];
                const draggedPos = allCards.indexOf(draggedElement);
                const targetPos = allCards.indexOf(this);
                
                if (draggedPos < targetPos) {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedElement, this);
                }
            }
            
            return false;
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            draggedElement = null;
            draggedIndex = null;
        }

        // Sort Functions
        function sortIPCards(sortBy) {
            if (!currentData || !currentData.targets) return;
            
            const container = document.getElementById('ipCardsContainer');
            const cards = [...container.children];
            
            const targets = currentData.targets.map((target, index) => ({
                target,
                index,
                card: cards[index]
            }));
            
            targets.sort((a, b) => {
                switch(sortBy) {
                    case 'name':
                        return a.target.name.localeCompare(b.target.name);
                    case 'latency':
                        return b.target.latency - a.target.latency;
                    case 'status':
                        return b.target.online - a.target.online;
                    default:
                        return 0;
                }
            });
            
            container.innerHTML = '';
            targets.forEach(item => {
                container.appendChild(item.card);
            });
        }

        // toggleMinimize, updateMinimizedArea - minwin-ip.jsë¡œ ì´ë™ë¨

        // Open Detail Modal
        function openDetailModal(index) {
            if (!currentData || !currentData.targets[index]) return;
            
            const target = currentData.targets[index];
            currentModalTarget = index;
            
            document.getElementById('modalTitle').textContent = target.name;
            document.getElementById('modalSubtitle').textContent = target.ip;
            
            document.getElementById('modalLatency').textContent = target.latency + ' ms';
            document.getElementById('modalMin').textContent = target.min + ' ms';
            document.getElementById('modalAvg').textContent = Math.round(target.avg) + ' ms';
            document.getElementById('modalMax').textContent = target.max + ' ms';
            
            const lossRate = target.total > 0 ? ((target.failed / target.total) * 100).toFixed(1) : 0;
            document.getElementById('modalLoss').textContent = lossRate + '%';
            document.getElementById('modalStatus').textContent = target.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
            document.getElementById('modalStatus').style.color = target.online ? 'var(--success)' : 'var(--error)';
            
            document.getElementById('modalTotal').textContent = target.total;
            document.getElementById('modalSuccess').textContent = target.total - target.failed;
            document.getElementById('modalFailed').textContent = target.failed;
            
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            document.getElementById('modalLastResponse').textContent = target.online ? timeStr : 'ì‘ë‹µ ì—†ìŒ';
            
            createModalChart(target, index);
            
            document.getElementById('detailModal').classList.add('active');
            document.body.style.overflow = 'hidden';  // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
        }

        // Close Detail Modal
        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
            document.body.style.overflow = '';  // ë°°ê²½ ìŠ¤í¬ë¡¤ ë³µì›
            if (modalChart) {
                modalChart.destroy();
                modalChart = null;
            }
            currentModalTarget = null;
        }

        // Create Modal Chart
        function createModalChart(target, index) {
            if (modalChart) {
                modalChart.destroy();
            }
            
            const ctx = document.getElementById('modalChart');
            const color = brightColors[index % brightColors.length];
            
            const now = new Date();
            const labels = Array(60).fill('').map((_, i) => {
                const time = new Date(now.getTime() - (59 - i) * 1000);
                return `${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}:${String(time.getSeconds()).padStart(2, '0')}`;
            });
            
            modalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì§€ì—°ì‹œê°„ (ms)',
                        data: target.history,
                        borderColor: color,
                        backgroundColor: color + '30',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3,
                        pointRadius: 1,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { 
                                color: '#e4e6eb', 
                                font: { size: 12 },
                                padding: 10
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 12 },
                            bodyFont: { size: 11 },
                            padding: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#3a3f5c' },
                            ticks: { 
                                color: '#b0b3b8',
                                font: { size: 11 }
                            },
                            title: {
                                display: true,
                                text: 'ms',
                                color: '#b0b3b8'
                            }
                        },
                        x: {
                            grid: { color: '#3a3f5c' },
                            ticks: { 
                                color: '#b0b3b8',
                                font: { size: 9 },
                                maxRotation: 45,
                                minRotation: 45,
                                autoSkip: true,
                                maxTicksLimit: 12
                            }
                        }
                    }
                }
            });
        }

        // Update Modal if Open
        function updateModalIfOpen() {
            if (currentModalTarget !== null && currentData && currentData.targets[currentModalTarget]) {
                const target = currentData.targets[currentModalTarget];
                
                document.getElementById('modalLatency').textContent = target.latency + ' ms';
                document.getElementById('modalMin').textContent = target.min + ' ms';
                document.getElementById('modalAvg').textContent = Math.round(target.avg) + ' ms';
                document.getElementById('modalMax').textContent = target.max + ' ms';
                
                const lossRate = target.total > 0 ? ((target.failed / target.total) * 100).toFixed(1) : 0;
                document.getElementById('modalLoss').textContent = lossRate + '%';
                document.getElementById('modalStatus').textContent = target.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
                document.getElementById('modalStatus').style.color = target.online ? 'var(--success)' : 'var(--error)';
                
                document.getElementById('modalTotal').textContent = target.total;
                document.getElementById('modalSuccess').textContent = target.total - target.failed;
                document.getElementById('modalFailed').textContent = target.failed;
                
                if (modalChart) {
                    const now = new Date();
                    const labels = Array(60).fill('').map((_, i) => {
                        const time = new Date(now.getTime() - (59 - i) * 1000);
                        return `${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}:${String(time.getSeconds()).padStart(2, '0')}`;
                    });
                    
                    modalChart.data.labels = labels;
                    modalChart.data.datasets[0].data = target.history;
                    modalChart.update();
                }
                
                const now = new Date();
                const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                document.getElementById('modalLastResponse').textContent = target.online ? timeStr : 'ì‘ë‹µ ì—†ìŒ';
            }
        }

        // Update IP Card
        function updateIPCard(card, target, index) {
            const statusBadge = card.querySelector(`#status-${index}`);
            if (statusBadge) {
                statusBadge.textContent = target.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
                statusBadge.className = target.online ? 'status-badge status-online' : 'status-badge status-offline';
            }

            const latencyEl = document.getElementById(`latency-${index}`);
            if (latencyEl) latencyEl.textContent = target.latency + ' ms';
            
            const minEl = document.getElementById(`min-${index}`);
            if (minEl) minEl.textContent = target.min + ' ms';
            
            const avgEl = document.getElementById(`avg-${index}`);
            if (avgEl) avgEl.textContent = Math.round(target.avg) + ' ms';
            
            const maxEl = document.getElementById(`max-${index}`);
            if (maxEl) maxEl.textContent = target.max + ' ms';

            if (ipCharts[index] && !card.classList.contains('minimized')) {
                ipCharts[index].data.datasets[0].data = target.history;
                // requestAnimationFrameìœ¼ë¡œ ë Œë”ë§ ìµœì í™”
                requestAnimationFrame(() => {
                    if (ipCharts[index]) {
                        ipCharts[index].update('none');  // ì• ë‹ˆë©”ì´ì…˜ ì—†ì´
                    }
                });
            }

            // íŒ¨í‚· ë°” ì—…ë°ì´íŠ¸ ìµœì í™” (DocumentFragment ì‚¬ìš©)
            const packetsContainer = document.getElementById(`packets-${index}`);
            if (packetsContainer && target.history) {
                const fragment = document.createDocumentFragment();
                const historyLen = Math.min(target.history.length, 60);  // ìµœëŒ€ 60ê°œë§Œ í‘œì‹œ
                const startIdx = Math.max(0, target.history.length - historyLen);
                
                for (let i = startIdx; i < target.history.length; i++) {
                    const div = document.createElement('div');
                    div.className = target.history[i] > 0 ? 'packet-bar packet-success' : 'packet-bar packet-fail';
                    fragment.appendChild(div);
                }
                packetsContainer.innerHTML = '';
                packetsContainer.appendChild(fragment);
            }
        }

        // Load Notifications
        async function loadNotifications() {
            try {
                const response = await fetch('/data/notification_log.json?t=' + Date.now());
                if (!response.ok) {
                    showEmptyNotifications();
                    return;
                }
                
                const logs = await response.json();
                allNotifications = logs.reverse();
                
                updateNotificationStats();
                renderNotifications();
            } catch (error) {
                console.error('ì•Œë¦¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                showEmptyNotifications();
            }
        }

        // Update Notification Stats
        function updateNotificationStats() {
            const total = allNotifications.length;
            const timeouts = allNotifications.filter(n => n.type === 'timeout').length;
            const recoveries = allNotifications.filter(n => n.type === 'recovery').length;

            document.getElementById('notifTotalCount').textContent = total;
            document.getElementById('notifTimeoutCount').textContent = timeouts;
            document.getElementById('notifRecoveryCount').textContent = recoveries;
        }

        // Render Notifications
        function renderNotifications() {
            const container = document.getElementById('notificationList');
            
            const filtered = currentFilter === 'all' 
                ? allNotifications 
                : allNotifications.filter(n => n.type === currentFilter);

            if (filtered.length === 0) {
                showEmptyNotifications();
                return;
            }

            container.innerHTML = filtered.map(notif => `
                <div class="notification-item ${notif.type}">
                    <div class="notification-header">
                        <span class="notification-type ${notif.type}">
                            ${notif.type === 'timeout' ? 'âš ï¸ íƒ€ì„ì•„ì›ƒ' : 'âœ… ë³µêµ¬'}
                        </span>
                        <span class="notification-time">${notif.date} ${notif.time}</span>
                    </div>
                    <div class="notification-name">${notif.name}</div>
                    <div class="notification-ip">${notif.ip}</div>
                </div>
            `).join('');
        }

        // Show Empty Notifications
        function showEmptyNotifications() {
            const container = document.getElementById('notificationList');
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“­</div>
                    <div>ì•„ì§ ì•Œë¦¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            `;
        }

        // Update Loop
        let updateErrorCount = 0;
        let lastSuccessfulUpdate = Date.now();
        
        function startUpdates() {
            // ê¸°ì¡´ ì¸í„°ë²Œ ì •ë¦¬
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            updateInterval = setInterval(() => {
                loadData();
            }, 1000);
            
            // ìƒíƒœ ëª¨ë‹ˆí„°ë§ (30ì´ˆë§ˆë‹¤)
            setInterval(() => {
                checkAndRecover();
            }, 30000);
        }
        
        // ìƒíƒœ ì²´í¬ ë° ìë™ ë³µêµ¬
        function checkAndRecover() {
            const now = Date.now();
            const timeSinceLastUpdate = now - lastSuccessfulUpdate;
            
            // 5ë¶„ ì´ìƒ ì—…ë°ì´íŠ¸ ì—†ìœ¼ë©´ ë³µêµ¬ ì‹œë„
            if (timeSinceLastUpdate > 5 * 60 * 1000) {
                console.warn('ì—…ë°ì´íŠ¸ ì¤‘ë‹¨ ê°ì§€ - ë³µêµ¬ ì‹œë„');
                recoverSystem();
            }
            
            // ì°¨íŠ¸ ìƒíƒœ í™•ì¸
            if (typeof comparisonChart !== 'undefined' && comparisonChart) {
                try {
                    // ì°¨íŠ¸ê°€ ìœ íš¨í•œì§€ í…ŒìŠ¤íŠ¸
                    const testAccess = comparisonChart.data;
                    if (!testAccess) {
                        console.warn('ì°¨íŠ¸ ìƒíƒœ ì´ìƒ - ì¬ìƒì„±');
                        if (typeof resetChartInstance === 'function') {
                            resetChartInstance();
                        } else {
                            initComparisonChart();
                        }
                    }
                } catch (e) {
                    console.error('ì°¨íŠ¸ ìƒíƒœ ì²´í¬ ì‹¤íŒ¨:', e);
                    initComparisonChart();
                }
            }
        }
        
        // ì‹œìŠ¤í…œ ë³µêµ¬
        function recoverSystem() {
            console.log('ì‹œìŠ¤í…œ ë³µêµ¬ ì‹œì‘...');
            
            // ì¸í„°ë²Œ ì¬ì‹œì‘
            stopUpdates();
            
            // ê°œë³„ IP ì°¨íŠ¸ ì •ë¦¬
            try {
                Object.keys(ipCharts).forEach(key => {
                    if (ipCharts[key]) {
                        ipCharts[key].destroy();
                    }
                });
                ipCharts = {};
            } catch (e) {
                console.error('IP ì°¨íŠ¸ ì •ë¦¬ ì‹¤íŒ¨:', e);
                ipCharts = {};
            }
            
            // ë¹„êµ ì°¨íŠ¸ ì¬ìƒì„±
            try {
                if (typeof resetChartInstance === 'function') {
                    resetChartInstance();
                } else if (typeof initComparisonChart === 'function') {
                    if (comparisonChart) {
                        comparisonChart.destroy();
                        comparisonChart = null;
                    }
                    initComparisonChart();
                }
            } catch (e) {
                console.error('ì°¨íŠ¸ ë³µêµ¬ ì‹¤íŒ¨:', e);
            }
            
            // IP ì¹´ë“œ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            try {
                const ipCardsContainer = document.getElementById('ipCardsContainer');
                if (ipCardsContainer) {
                    ipCardsContainer.innerHTML = '';
                }
            } catch (e) {
                console.error('IP ì¹´ë“œ ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
            }
            
            // ì—…ë°ì´íŠ¸ ì¬ì‹œì‘
            setTimeout(() => {
                updateInterval = setInterval(() => {
                    loadData();
                }, 1000);
                console.log('ì‹œìŠ¤í…œ ë³µêµ¬ ì™„ë£Œ');
            }, 500);
        }
        
        // Page Visibility API - íƒ­ í™œì„±í™” ì‹œ ë³µêµ¬
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                console.log('íƒ­ í™œì„±í™” - ìƒíƒœ í™•ì¸');
                const now = Date.now();
                const timeSinceLastUpdate = now - lastSuccessfulUpdate;
                
                // 1ë¶„ ì´ìƒ ë¹„í™œì„± ìƒíƒœì˜€ìœ¼ë©´ ë³µêµ¬
                if (timeSinceLastUpdate > 60000) {
                    console.log('ì¥ì‹œê°„ ë¹„í™œì„± í›„ ë³µê·€ - ë³µêµ¬ ì‹¤í–‰');
                    recoverSystem();
                }
            }
        });

        function stopUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }
        }

        // ë¯¸ì‘ë‹µ ê¸°ë¡ ê´€ë¦¬ Functions (v2.6)
        async function loadOutages() {
            try {
                const response = await fetch('/data/outage_log.json?t=' + Date.now());
                const data = await response.json();
                allOutages = data.outages || [];
                renderOutages();
            } catch (error) {
                console.error('ë¯¸ì‘ë‹µ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('outageList').innerHTML = '<div class="no-outages">ë¯¸ì‘ë‹µ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        function renderOutages() {
            const container = document.getElementById('outageList');
            
            let filtered = allOutages.filter(o => {
                const statusMatch = currentOutageFilter.status === 'all' || o.status === currentOutageFilter.status;
                const groupMatch = currentOutageFilter.group === 'all' || o.group === currentOutageFilter.group;
                return statusMatch && groupMatch;
            });

            filtered.sort((a, b) => new Date(b.start_time) - new Date(a.start_time));

            if (filtered.length === 0) {
                container.innerHTML = '<div class="no-outages">ë¯¸ì‘ë‹µ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            container.innerHTML = filtered.map(outage => {
                let downtimeStr;
                if (outage.status === 'ongoing') {
                    const now = new Date();
                    const start = new Date(outage.start_time);
                    const seconds = Math.floor((now - start) / 1000);
                    downtimeStr = formatDuration(seconds) + ' (ì§„í–‰ ì¤‘)';
                } else {
                    downtimeStr = formatDuration(outage.downtime_seconds);
                }

                return `
                    <div class="outage-card ${outage.status}">
                        <div class="outage-header">
                            <span class="outage-status-badge ${outage.status}">
                                ${outage.status === 'ongoing' ? 'ğŸ”´ ì§„í–‰ì¤‘' : 'ğŸŸ¢ ë³µêµ¬ë¨'}
                            </span>
                            <span class="priority priority-${outage.priority}">P${outage.priority}</span>
                        </div>
                        <div class="outage-info">
                            <h3>${outage.name}</h3>
                            <p class="ip">${outage.ip}</p>
                            <p class="group">ê·¸ë£¹: ${outage.group}</p>
                        </div>
                        <div class="outage-timeline">
                            <div class="timeline-item">
                                <span class="label">ì‹œì‘:</span>
                                <span class="time">${formatTime(outage.start_time)}</span>
                            </div>
                            ${outage.end_time ? `
                            <div class="timeline-item">
                                <span class="label">ì¢…ë£Œ:</span>
                                <span class="time">${formatTime(outage.end_time)}</span>
                            </div>
                            ` : ''}
                            <div class="timeline-item">
                                <span class="label">ë‹¤ìš´íƒ€ì„:</span>
                                <span class="time">${downtimeStr}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatDuration(seconds) {
            if (!seconds) return '0ì´ˆ';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (hours > 0) {
                return `${hours}ì‹œê°„ ${minutes}ë¶„`;
            } else if (minutes > 0) {
                return `${minutes}ë¶„ ${secs}ì´ˆ`;
            } else {
                return `${secs}ì´ˆ`;
            }
        }

        function formatTime(timeStr) {
            if (!timeStr) return 'N/A';
            const date = new Date(timeStr);
            return date.toLocaleString('ko-KR');
        }

        // Settings Functions - settings.jsë¡œ ì´ë™ë¨

        // ========================================
        // ì•ŒëŒ ê¸°ëŠ¥ (v2.7)
        // ========================================
        
        /**
         * ì•ŒëŒ ì„¤ì • ì´ˆê¸°í™”
         */
        function initAlarmSettings() {
            // localStorageì—ì„œ ì„¤ì • ë¡œë“œ
            loadAlarmSettings();
            
            // UIì— ì„¤ì •ê°’ ë°˜ì˜
            const alarmEnabled = document.getElementById('alarmEnabled');
            const alarmThreshold = document.getElementById('alarmThreshold');
            const alarmThresholdSlider = document.getElementById('alarmThreshold_slider');
            const alarmSound = document.getElementById('alarmSound');
            const alarmRepeat = document.getElementById('alarmRepeat');
            
            if (alarmEnabled) alarmEnabled.checked = alarmSettings.enabled;
            if (alarmThreshold) alarmThreshold.value = alarmSettings.threshold;
            if (alarmThresholdSlider) alarmThresholdSlider.value = alarmSettings.threshold;
            if (alarmSound) alarmSound.value = alarmSettings.sound;
            if (alarmRepeat) alarmRepeat.checked = alarmSettings.repeat;
            
            // ë¯¸ì‘ë‹µ ê¸°ë¡ ì„ê³„ê°’ ì²´í¬ë°•ìŠ¤
            const record30s = document.getElementById('record30s');
            const record1m = document.getElementById('record1m');
            const record3m = document.getElementById('record3m');
            const record5m = document.getElementById('record5m');
            const record10m = document.getElementById('record10m');
            
            if (record30s) record30s.checked = alarmSettings.recordThresholds.sec30;
            if (record1m) record1m.checked = alarmSettings.recordThresholds.min1;
            if (record3m) record3m.checked = alarmSettings.recordThresholds.min3;
            if (record5m) record5m.checked = alarmSettings.recordThresholds.min5;
            if (record10m) record10m.checked = alarmSettings.recordThresholds.min10;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            if (alarmEnabled) {
                alarmEnabled.addEventListener('change', (e) => {
                    alarmSettings.enabled = e.target.checked;
                    saveAlarmSettings();
                    if (!e.target.checked) {
                        stopAlarm();
                    }
                });
            }
            
            if (alarmThreshold) {
                alarmThreshold.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    alarmSettings.threshold = value;
                    if (alarmThresholdSlider) alarmThresholdSlider.value = value;
                    saveAlarmSettings();
                });
            }
            
            if (alarmThresholdSlider) {
                alarmThresholdSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    alarmSettings.threshold = value;
                    if (alarmThreshold) alarmThreshold.value = value;
                    saveAlarmSettings();
                });
            }
            
            if (alarmSound) {
                alarmSound.addEventListener('change', (e) => {
                    alarmSettings.sound = e.target.value;
                    saveAlarmSettings();
                });
            }
            
            if (alarmRepeat) {
                alarmRepeat.addEventListener('change', (e) => {
                    alarmSettings.repeat = e.target.checked;
                    saveAlarmSettings();
                });
            }
            
            // ë¯¸ì‘ë‹µ ê¸°ë¡ ì„ê³„ê°’ ì´ë²¤íŠ¸
            [record30s, record1m, record3m, record5m, record10m].forEach((el, index) => {
                if (el) {
                    el.addEventListener('change', (e) => {
                        const keys = ['sec30', 'min1', 'min3', 'min5', 'min10'];
                        alarmSettings.recordThresholds[keys[index]] = e.target.checked;
                        saveAlarmSettings();
                    });
                }
            });
            
            // ì•ŒëŒ í…ŒìŠ¤íŠ¸ ë²„íŠ¼
            const testBtn = document.getElementById('testAlarmSound');
            if (testBtn) {
                testBtn.addEventListener('click', () => {
                    playAlarmSound(alarmSettings.sound);
                });
            }
            
            // ì•ŒëŒ ë‹«ê¸° ë²„íŠ¼
            const alarmClose = document.getElementById('alarmClose');
            if (alarmClose) {
                alarmClose.addEventListener('click', stopAlarm);
            }
        }
        
        /**
         * ì•ŒëŒ ì„¤ì • ì €ì¥
         */
        function saveAlarmSettings() {
            localStorage.setItem('alarmSettings', JSON.stringify(alarmSettings));
            console.log('ì•ŒëŒ ì„¤ì • ì €ì¥:', alarmSettings);
        }
        
        /**
         * ì•ŒëŒ ì„¤ì • ë¡œë“œ
         */
        function loadAlarmSettings() {
            const saved = localStorage.getItem('alarmSettings');
            if (saved) {
                try {
                    const loaded = JSON.parse(saved);
                    alarmSettings = { ...alarmSettings, ...loaded };
                    console.log('ì•ŒëŒ ì„¤ì • ë¡œë“œ:', alarmSettings);
                } catch (e) {
                    console.error('ì•ŒëŒ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', e);
                }
            }
        }
        
        /**
         * ì•ŒëŒ ì‚¬ìš´ë“œ ì¬ìƒ (Web Audio API)
         */
        function playAlarmSound(type) {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch (type) {
                    case 'beep':
                        // ê¸°ë³¸ ë¹„í”„ìŒ
                        oscillator.frequency.value = 800;
                        oscillator.type = 'sine';
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                        
                    case 'alert':
                        // ê²½ê³ ìŒ (2íšŒ ë°˜ë³µ)
                        oscillator.frequency.value = 1000;
                        oscillator.type = 'square';
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime + 0.15);
                        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime + 0.25);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                        
                    case 'chime':
                        // ì°¨ì„ë²¨
                        oscillator.frequency.value = 523.25;  // C5
                        oscillator.type = 'sine';
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 1);
                        
                        // í™”ìŒ ì¶”ê°€
                        const osc2 = audioContext.createOscillator();
                        const gain2 = audioContext.createGain();
                        osc2.connect(gain2);
                        gain2.connect(audioContext.destination);
                        osc2.frequency.value = 659.25;  // E5
                        osc2.type = 'sine';
                        gain2.gain.setValueAtTime(0.2, audioContext.currentTime);
                        gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                        osc2.start(audioContext.currentTime);
                        osc2.stop(audioContext.currentTime + 1);
                        break;
                }
            } catch (e) {
                console.error('ì•ŒëŒ ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:', e);
            }
        }
        
        /**
         * ì•ŒëŒ ì‹œì‘
         */
        function startAlarm(ipName, offlineSeconds) {
            if (alarmActive) return;  // ì´ë¯¸ ì•ŒëŒ ì¤‘
            
            alarmActive = true;
            const indicator = document.getElementById('alarmIndicator');
            const message = document.getElementById('alarmMessage');
            
            if (indicator && message) {
                message.textContent = `${ipName}: ${offlineSeconds}ì´ˆ ì´ìƒ ë¯¸ì‘ë‹µ`;
                indicator.classList.add('active');
            }
            
            // ì•ŒëŒ ì‚¬ìš´ë“œ ì¬ìƒ
            playAlarmSound(alarmSettings.sound);
            
            // ë°˜ë³µ ì•ŒëŒ
            if (alarmSettings.repeat) {
                alarmRepeatInterval = setInterval(() => {
                    if (alarmActive) {
                        playAlarmSound(alarmSettings.sound);
                    }
                }, 30000);  // 30ì´ˆë§ˆë‹¤ ë°˜ë³µ
            }
        }
        
        /**
         * ì•ŒëŒ ì¤‘ì§€
         */
        function stopAlarm() {
            alarmActive = false;
            const indicator = document.getElementById('alarmIndicator');
            if (indicator) {
                indicator.classList.remove('active');
            }
            
            if (alarmRepeatInterval) {
                clearInterval(alarmRepeatInterval);
                alarmRepeatInterval = null;
            }
        }
        
        /**
         * IP ì˜¤í”„ë¼ì¸ ìƒíƒœ ì²´í¬ ë° ì•ŒëŒ ì²˜ë¦¬
         */
        function checkOfflineStatus(targets) {
            if (!alarmSettings.enabled) return;
            
            const now = Date.now();
            
            targets.forEach(target => {
                const key = target.ip;
                
                if (!target.online) {
                    // ì˜¤í”„ë¼ì¸ ìƒíƒœ
                    if (!ipOfflineTimers[key]) {
                        ipOfflineTimers[key] = now;
                    }
                    
                    const offlineSeconds = Math.floor((now - ipOfflineTimers[key]) / 1000);
                    
                    // ì•ŒëŒ ì„ê³„ê°’ ì²´í¬
                    if (offlineSeconds >= alarmSettings.threshold && !alarmActive) {
                        startAlarm(target.name, offlineSeconds);
                    }
                } else {
                    // ì˜¨ë¼ì¸ìœ¼ë¡œ ë³µêµ¬
                    if (ipOfflineTimers[key]) {
                        delete ipOfflineTimers[key];
                        // ì•ŒëŒ ì¤‘ì§€
                        if (alarmActive) {
                            stopAlarm();
                        }
                    }
                }
            });
        }

    </script>

</body>
</html>
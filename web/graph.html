<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Monitor v2.7 Dashboard</title>
    <link rel="stylesheet" href="/web/css/variables.css">
    <link rel="stylesheet" href="/web/css/base.css">
    <link rel="stylesheet" href="/web/css/components.css">
    <link rel="stylesheet" href="/web/css/dashboard.css">
    <link rel="stylesheet" href="/web/css/notifications.css">
    <link rel="stylesheet" href="/web/css/outages.css">
    <link rel="stylesheet" href="/web/css/settings.css">
    <link rel="stylesheet" href="/web/css/responsive.css">
    <script src="/web/chart.umd.min.js"></script>
    <style>
        /* ìµœì†Œí™” ì• ë‹ˆë©”ì´ì…˜ */
        .collapsible-content {
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out;
            opacity: 1;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
        }
        
        /* ìµœì†Œí™” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .minimize-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .minimize-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .minimize-btn svg {
            transition: transform 0.3s ease;
        }
        
        .minimize-btn.minimized svg {
            transform: rotate(180deg);
        }
        
        /* ì‹œê°„ ë²”ìœ„ ë¼ë””ì˜¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (v2.7) */
        .time-range-radio-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .time-range-radio {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .time-range-radio:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .time-range-radio input[type="radio"] {
            margin-right: 8px;
            accent-color: var(--primary);
        }
        
        .time-range-radio input[type="radio"]:checked + .radio-label {
            color: var(--primary);
            font-weight: 600;
        }
        
        .time-range-radio:has(input:checked) {
            background: rgba(99, 102, 241, 0.15);
            border-color: var(--primary);
        }
        
        .radio-label {
            color: #e4e6eb;
            font-size: 13px;
        }
        
        /* í™˜ê²½ì„¤ì • íƒ­ í•œ ì¤„ ìŠ¤íƒ€ì¼ (v2.7) */
        .settings-tabs-row {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .settings-tabs-row .settings-tab-btn {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #b0b3b8;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            white-space: nowrap;
        }
        
        .settings-tabs-row .settings-tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .settings-tabs-row .settings-tab-btn.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            color: #fff;
            font-weight: 600;
        }
    </style>

</head>
<body>
    <!-- Header -->
    <div class="header" id="mainHeader">
        <h1>ğŸŒ Ping Monitor v2.7 Dashboard</h1>
        <div class="header-subtitle">Real-time Network Monitoring with Outage Management</div>
    </div>

    <!-- Tab Navigation -->
        <div class="container">
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="dashboard">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab-btn" data-tab="notifications">ğŸ”” ì•Œë¦¼ ê¸°ë¡</button>
            <button class="tab-btn" data-tab="outages">ğŸ”¥ ì¥ì•  í˜„í™©</button>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <!-- Unified Control Bar -->
            <div class="unified-control-bar">
                <!-- Time Info -->
                <div class="control-group">
                    <div class="time-display">
                        <div class="time-label">í˜„ì¬ ì‹œê°„</div>
                        <div class="time-value large" id="currentTime">00:00:00</div>
                    </div>
                    <div class="time-display">
                        <div class="time-label">í˜„ì¬ ë‚ ì§œ</div>
                        <div class="time-value" id="currentDate">0000-00-00</div>
                    </div>
                    <div class="time-display">
                        <div class="time-label">ëª¨ë‹ˆí„°ë§ ì‹œê°„</div>
                        <div class="time-value" id="uptime">00:00:00</div>
                    </div>
                </div>
                
                <div class="control-divider"></div>
                
                <!-- Tab & Control Buttons -->
                <div class="control-group">
                    <button type="button" class="btn btn-primary" id="toggleBtn">ì¼ì‹œì •ì§€</button>
                    <button type="button" class="btn btn-success" id="refreshBtn">ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div class="control-divider"></div>
                
                <!-- Stats -->
                <div class="control-group" style="flex: 1; justify-content: space-around;">
                    <div class="stat-item-inline">
                        <div class="stat-label">ì „ì²´ IP</div>
                        <div class="stat-value" id="totalIPs">0</div>
                    </div>
                    <div class="stat-item-inline">
                        <div class="stat-label">ì˜¨ë¼ì¸</div>
                        <div class="stat-value" style="color: var(--success);" id="onlineCount">0</div>
                    </div>
                    <div class="stat-item-inline">
                        <div class="stat-label">ì˜¤í”„ë¼ì¸</div>
                        <div class="stat-value" style="color: var(--error);" id="offlineCount">0</div>
                    </div>
                    <div class="stat-item-inline">
                        <div class="stat-label">í‰ê·  ì§€ì—°</div>
                        <div class="stat-value" id="avgLatency">0</div>
                    </div>
                </div>
                
                <div class="control-divider"></div>
                
                <!-- Sort Controls -->
                <div class="control-group">
                    <button class="card-sort-btn" id="sortByName">ì´ë¦„ìˆœ</button>
                    <button class="card-sort-btn" id="sortByLatency">ì§€ì—°ìˆœ</button>
                    <button class="card-sort-btn" id="sortByStatus">ìƒíƒœìˆœ</button>
                </div>
            </div>

            <!-- Comparison Chart -->
            <div class="card" id="comparisonChartCard">
                <div class="card-header">
                    <div class="card-title">IP ë¹„êµ íƒ€ì„ë¼ì¸</div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button class="chart-settings-btn" id="chartSettingsBtn" title="í™˜ê²½ì„¤ì •">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M12 1v6m0 6v6m5.2-13.2l-4.3 4.3M7.8 16.4l-4.3 4.3M23 12h-6m-6 0H1m17.8-5.2l-4.3 4.3M7.8 7.8L3.5 3.5"></path>
                            </svg>
                        </button>
                        <button class="minimize-btn" id="timelineMinimizeBtn" title="íƒ€ì„ë¼ì¸ ìµœì†Œí™”/í™•ëŒ€">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="18 15 12 9 6 15"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="collapsible-content" id="timelineContent">
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Chart Settings Modal -->
            <div class="modal" id="chartSettingsModal">
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3>í™˜ê²½ì„¤ì •</h3>
                        <button class="modal-close" id="closeChartSettings">&times;</button>
                    </div>
                    <div class="modal-body">
                <!-- Settings Tabs -->
                <div class="settings-tabs-row">
                    <button class="settings-tab-btn active" data-settings-tab="chart">
                        ğŸ“Š ì°¨íŠ¸ ì„¤ì •
                    </button>
                    <button class="settings-tab-btn" data-settings-tab="timerange">
                        â±ï¸ ì‹œê°„ ë²”ìœ„
                    </button>
                    <button class="settings-tab-btn" data-settings-tab="thresholds">
                        ğŸ¯ ê·¸ë£¹ë³„ ì„ê³„ê°’
                    </button>
                    <button class="settings-tab-btn" data-settings-tab="ipgroups">
                        ğŸ“‹ IP ê·¸ë£¹ ê´€ë¦¬
                    </button>
                </div>
                
                <div class="settings-success" id="settingsSuccess" style="margin-top: 16px;">
                    âœ“ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
                </div>
                
                <!-- Tab 1: ì°¨íŠ¸ ì„¤ì • (ê¸°ì¡´) -->
                <div class="settings-tab-content active" id="settings-chart">
                    <div class="chart-settings-controls">
                        <button class="btn btn-sm btn-secondary" id="selectAllIPs">ì „ì²´ ì„ íƒ</button>
                        <button class="btn btn-sm btn-secondary" id="deselectAllIPs">ì „ì²´ í•´ì œ</button>
                        <button class="btn btn-sm btn-primary" id="saveChartSettings">ì €ì¥</button>
                    </div>
                    <div class="ip-checkbox-list" id="ipCheckboxList">
                        <!-- IP ì²´í¬ë°•ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
                <!-- Tab 2: ì‹œê°„ ë²”ìœ„ (v2.7) -->
                <div class="settings-tab-content" id="settings-timerange">
                    <div class="settings-section">
                        <div class="settings-section-title">
                            â±ï¸ íƒ€ì„ë¼ì¸ ì‹œê°„ ë²”ìœ„
                        </div>
                        <div class="settings-help" style="margin-bottom: 16px;">
                            IP ë¹„êµ íƒ€ì„ë¼ì¸ ì°¨íŠ¸ì— í‘œì‹œí•  ì‹œê°„ ë²”ìœ„ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
                        </div>
                        <div class="time-range-radio-group" id="timeRangeRadioGroup">
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="60">
                                <span class="radio-label">1ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="300">
                                <span class="radio-label">5ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="600">
                                <span class="radio-label">10ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="1800">
                                <span class="radio-label">30ë¶„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="3600">
                                <span class="radio-label">1ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="10800">
                                <span class="radio-label">3ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="18000">
                                <span class="radio-label">5ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="43200">
                                <span class="radio-label">12ì‹œê°„</span>
                            </label>
                            <label class="time-range-radio">
                                <input type="radio" name="timeRange" value="86400">
                                <span class="radio-label">24ì‹œê°„</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 3: ê·¸ë£¹ë³„ ì„ê³„ê°’ -->
                <div class="settings-tab-content" id="settings-thresholds">
                    <!-- Empty State Guide -->
                    <div id="thresholdEmptyState" class="empty-state" style="display: block;">
                        <div style="font-size: 48px; margin-bottom: 16px;">â±ï¸</div>
                        <h3 style="font-size: 20px; margin-bottom: 12px; color: var(--text-primary);">ê·¸ë£¹ë³„ ì„ê³„ê°’ ì„¤ì •</h3>
                        <p style="font-size: 14px; line-height: 1.6; max-width: 500px; margin: 0 auto;">
                            ê° ê·¸ë£¹ë³„ë¡œ ì¥ì•  íŒì • ì‹œê°„ì„ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                            IPê°€ ì„¤ì •ëœ ì‹œê°„(ì´ˆ) ë™ì•ˆ ì—°ì†ìœ¼ë¡œ ë‹¤ìš´ë˜ë©´ ì¥ì• ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤.<br><br>
                            <strong>ì˜ˆì‹œ:</strong> ì„œë²„ ê·¸ë£¹ = 180ì´ˆ â†’ 3ë¶„ê°„ ë‹¤ìš´ ì‹œ ì¥ì•  ê¸°ë¡
                        </p>
                    </div>
                    
                    <!-- Content -->
                    <div id="thresholdContent" style="display: none;">
                        <div class="settings-section">
                            <div class="settings-section-title">
                                âš¡ ê¸°ë³¸ ì„ê³„ê°’
                            </div>
                            <div class="settings-form-group">
                                <label class="settings-label">ì¥ì•  íŒì • ì„ê³„ê°’ (ì´ˆ)</label>
                                <input type="number" class="settings-input" id="defaultThreshold" 
                                       value="300" min="30" max="3600" step="30">
                                <div class="settings-help">
                                    IPê°€ ì´ ì‹œê°„(ì´ˆ) ë™ì•ˆ ë‹¤ìš´ë˜ë©´ ì¥ì• ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤. (ê¸°ë³¸: 300ì´ˆ = 5ë¶„)
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <div class="settings-section-title">
                                ğŸ“Š ê·¸ë£¹ë³„ ì»¤ìŠ¤í…€ ì„ê³„ê°’
                            </div>
                            <table class="threshold-table">
                                <thead>
                                    <tr>
                                        <th>ê·¸ë£¹</th>
                                        <th>ì„ê³„ê°’ (ì´ˆ)</th>
                                        <th>ì„¤ëª…</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>ğŸ–¥ï¸ ì„œë²„</td>
                                        <td><input type="number" id="thresh_ì„œë²„" value="180" min="30" max="3600" step="30"></td>
                                        <td class="settings-help">ì„œë²„: 3ë¶„ (180ì´ˆ)</td>
                                    </tr>
                                    <tr>
                                        <td>ğŸŒ ë„¤íŠ¸ì›Œí¬</td>
                                        <td><input type="number" id="thresh_ë„¤íŠ¸ì›Œí¬" value="300" min="30" max="3600" step="30"></td>
                                        <td class="settings-help">ë„¤íŠ¸ì›Œí¬: 5ë¶„ (300ì´ˆ)</td>
                                    </tr>
                                    <tr>
                                        <td>ğŸ›¡ï¸ ë°©í™”ë²½</td>
                                        <td><input type="number" id="thresh_ë°©í™”ë²½" value="120" min="30" max="3600" step="30"></td>
                                        <td class="settings-help">ë°©í™”ë²½: 2ë¶„ (120ì´ˆ)</td>
                                    </tr>
                                    <tr>
                                        <td>ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤</td>
                                        <td><input type="number" id="thresh_ë°ì´í„°ë² ì´ìŠ¤" value="180" min="30" max="3600" step="30"></td>
                                        <td class="settings-help">ë°ì´í„°ë² ì´ìŠ¤: 3ë¶„ (180ì´ˆ)</td>
                                    </tr>
                                    <tr>
                                        <td>ğŸŒ ì›¹ì„œë²„</td>
                                        <td><input type="number" id="thresh_ì›¹ì„œë²„" value="240" min="30" max="3600" step="30"></td>
                                        <td class="settings-help">ì›¹ì„œë²„: 4ë¶„ (240ì´ˆ)</td>
                                    </tr>
                                    <tr>
                                        <td>ğŸ“¦ ìŠ¤í† ë¦¬ì§€</td>
                                        <td><input type="number" id="thresh_ìŠ¤í† ë¦¬ì§€" value="300" min="30" max="3600" step="30"></td>
                                        <td class="settings-help">ìŠ¤í† ë¦¬ì§€: 5ë¶„ (300ì´ˆ)</td>
                                    </tr>
                                    <tr>
                                        <td>ğŸ”§ ê¸°íƒ€</td>
                                        <td><input type="number" id="thresh_ê¸°íƒ€" value="300" min="30" max="3600" step="30"></td>
                                        <td class="settings-help">ê¸°íƒ€: 5ë¶„ (300ì´ˆ)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Tab 4: IP ê·¸ë£¹ ê´€ë¦¬ -->
                <div class="settings-tab-content" id="settings-ipgroups">
                    <!-- Empty State Guide -->
                    <div id="ipgroupEmptyState" class="empty-state" style="display: block;">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ·ï¸</div>
                        <h3 style="font-size: 20px; margin-bottom: 12px; color: var(--text-primary);">IP ê·¸ë£¹ ë° ìš°ì„ ìˆœìœ„ ê´€ë¦¬</h3>
                        <p style="font-size: 14px; line-height: 1.6; max-width: 500px; margin: 0 auto;">
                            ëª¨ë‹ˆí„°ë§ ì¤‘ì¸ IPë¥¼ ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜í•˜ê³  ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                            ìš°ì„ ìˆœìœ„ 1ì´ ê°€ì¥ ë†’ìœ¼ë©°, ì¥ì•  ë°œìƒ ì‹œ ì¤‘ìš”ë„ë¥¼ íŒë‹¨í•˜ëŠ” ê¸°ì¤€ì´ ë©ë‹ˆë‹¤.<br><br>
                            <strong>ê·¸ë£¹ ì¢…ë¥˜:</strong> ì„œë²„, ë„¤íŠ¸ì›Œí¬, ë°©í™”ë²½, ë°ì´í„°ë² ì´ìŠ¤, ì›¹ì„œë²„, ìŠ¤í† ë¦¬ì§€, ê¸°íƒ€
                        </p>
                    </div>
                    
                    <!-- Content -->
                    <div id="ipgroupContent" style="display: none;">
                        <div class="settings-section">
                            <div class="settings-section-title">
                                ğŸ·ï¸ IPë³„ ê·¸ë£¹ ë° ìš°ì„ ìˆœìœ„
                            </div>
                            <div class="settings-help" style="margin-bottom: 16px;">
                                ê° IPì˜ ê·¸ë£¹ê³¼ ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ìš°ì„ ìˆœìœ„ 1ì´ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤.
                            </div>
                            <table class="ip-config-table" id="ipConfigTable">
                                <thead>
                                    <tr>
                                        <th>IP ì£¼ì†Œ</th>
                                        <th>ì´ë¦„</th>
                                        <th>ê·¸ë£¹</th>
                                        <th>ìš°ì„ ìˆœìœ„ (1-5)</th>
                                    </tr>
                                </thead>
                                <tbody id="ipConfigTableBody">
                                    <!-- Dynamically populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                    </div><!-- modal-body -->
                </div><!-- modal-content -->
            </div><!-- modal -->

            <!-- Minimized Cards Area -->
            <div id="minimizedCardsArea" class="minimized-cards-area" style="display: none;">
                <div class="minimized-area-header">
                    <span class="minimized-area-title">ğŸ“¦ ìµœì†Œí™”ëœ IP</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="minimized-count" id="minimizedCount">0</span>
                        <button class="minimize-btn" id="minimizedAreaMinimizeBtn" title="ìµœì†Œí™”ëœ IP ì˜ì—­ ìµœì†Œí™”/í™•ëŒ€">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="18 15 12 9 6 15"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="collapsible-content" id="minimizedAreaContent">
                    <div id="minimizedCardsContainer" class="minimized-cards-container"></div>
                </div>
            </div>

            <!-- IP Cards -->
            <div id="ipCardsContainer" class="ip-grid"></div>
        </div>

        <!-- Notifications Tab -->
        <div class="tab-content" id="notifications">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì „ì²´ ì•Œë¦¼</div>
                    <div class="stat-value" id="notifTotalCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">íƒ€ì„ì•„ì›ƒ</div>
                    <div class="stat-value" style="color: var(--error);" id="notifTimeoutCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ë³µêµ¬</div>
                    <div class="stat-value" style="color: var(--success);" id="notifRecoveryCount">0</div>
                </div>
            </div>

            <!-- Notification Log -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ì•Œë¦¼ ê¸°ë¡</div>
                </div>
                
                <div class="filter-bar">
                    <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                    <button class="filter-btn" data-filter="timeout">íƒ€ì„ì•„ì›ƒë§Œ</button>
                    <button class="filter-btn" data-filter="recovery">ë³µêµ¬ë§Œ</button>
                </div>

                <div class="notification-list" id="notificationList">
                    <div class="loading">ì•Œë¦¼ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 class="modal-title" id="modalTitle">IP ìƒì„¸ ì •ë³´</h2>
                    <p id="modalSubtitle" style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;"></p>
                </div>
                <button class="modal-close" id="modalClose">Ã—</button>
            </div>
            <div class="modal-body">
                <!-- Stats -->
                <div class="modal-stats">
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">í˜„ì¬ ì§€ì—°ì‹œê°„</div>
                        <div class="modal-stat-value" id="modalLatency">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">ìµœì†Œ</div>
                        <div class="modal-stat-value" style="color: var(--success);" id="modalMin">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">í‰ê· </div>
                        <div class="modal-stat-value" style="color: var(--info);" id="modalAvg">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">ìµœëŒ€</div>
                        <div class="modal-stat-value" style="color: var(--error);" id="modalMax">0 ms</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">íŒ¨í‚· ì†ì‹¤ë¥ </div>
                        <div class="modal-stat-value" id="modalLoss">0%</div>
                    </div>
                    <div class="modal-stat-card">
                        <div class="modal-stat-label">ìƒíƒœ</div>
                        <div class="modal-stat-value" id="modalStatus">ì˜¤í”„ë¼ì¸</div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="modal-chart-container">
                    <canvas id="modalChart"></canvas>
                </div>

                <!-- Details -->
                <div class="modal-details">
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ì´ ìš”ì²­</div>
                        <div class="modal-detail-value" id="modalTotal">0</div>
                    </div>
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ì„±ê³µ</div>
                        <div class="modal-detail-value" style="color: var(--success);" id="modalSuccess">0</div>
                    </div>
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ì‹¤íŒ¨</div>
                        <div class="modal-detail-value" style="color: var(--error);" id="modalFailed">0</div>
                    </div>
                    <div class="modal-detail-item">
                        <div class="modal-detail-label">ë§ˆì§€ë§‰ ì‘ë‹µ ì‹œê°„</div>
                        <div class="modal-detail-value" id="modalLastResponse">--:--:--</div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <script>
        // Global State
        let isRunning = true;
        let updateInterval;
        let timeInterval;
        let comparisonChart;
        let ipCharts = {};
        let currentData = null;
        let draggedElement = null;
        let draggedIndex = null;
        let startTime = Date.now();
        let pausedElapsed = 0;
        let pausedTime = 0;
        let modalChart = null;
        let currentModalTarget = null;
        
        // Chart Visibility
        let visibleIPs = new Set();
        
        // Extended History for Timeline (v2.7)
        let extendedHistory = {};  // IPë³„ í™•ì¥ íˆìŠ¤í† ë¦¬ ì €ì¥ {ip: [latency, ...]}
        let selectedTimeRange = 60;  // ê¸°ë³¸ 1ë¶„ (60ì´ˆ)
        const MAX_HISTORY_POINTS = 86400;  // ìµœëŒ€ 24ì‹œê°„ (ì´ˆ ë‹¨ìœ„)
        
        // Notification State
        let allNotifications = [];
        let currentFilter = 'all';
        let allOutages = [];
        let currentOutageFilter = {status: 'all', group: 'all'};

        // Bright Colors for Charts
        const brightColors = [
            '#FF6B9D', '#C44569', '#FFA07A', '#FF8C42',
            '#FFD93D', '#6BCF7F', '#4ECDC4', '#45B7D1',
            '#5F27CD', '#A55EEA', '#FF6348', '#FF9FF3',
            '#54A0FF', '#48DBFB', '#1DD1A1', '#00D2D3',
            '#FD79A8', '#FDCB6E', '#6C5CE7', '#A29BFE',
            '#74B9FF', '#81ECEC', '#55EFC4', '#FFEAA7'
        ];

        // DOMì´ ì¤€ë¹„ëœ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Initialize charts and data
            initComparisonChart();
            loadData();
            startUpdates();
            
            // Start time updates
            updateTime();
            timeInterval = setInterval(updateTime, 1000);
        });

        // ë¸Œë¼ìš°ì € ì¢…ë£Œ ê°ì§€
        let isRefreshing = false;
        
        window.addEventListener('beforeunload', function(e) {
            // ìƒˆë¡œê³ ì¹¨ì¸ì§€ í™•ì¸
            if (performance.navigation.type === 1) {
                isRefreshing = true;
                return;
            }
            
            // ë¸Œë¼ìš°ì € ë‹«ê¸° ì‹œ ì„œë²„ ì¢…ë£Œ ìš”ì²­
            if (!isRefreshing) {
                navigator.sendBeacon('/shutdown');
            }
        });

        function initializeEventListeners() {
            // Timeline Range Radio Buttons (v2.7)
            const timeRangeRadios = document.querySelectorAll('input[name="timeRange"]');
            if (timeRangeRadios.length > 0) {
                // ì €ì¥ëœ ì‹œê°„ ë²”ìœ„ ë³µì›
                const savedRange = localStorage.getItem('timelineRange');
                if (savedRange) {
                    selectedTimeRange = parseInt(savedRange);
                    const savedRadio = document.querySelector(`input[name="timeRange"][value="${savedRange}"]`);
                    if (savedRadio) {
                        savedRadio.checked = true;
                    }
                } else {
                    // ê¸°ë³¸ê°’ 1ë¶„ ì„ íƒ
                    const defaultRadio = document.querySelector('input[name="timeRange"][value="60"]');
                    if (defaultRadio) {
                        defaultRadio.checked = true;
                    }
                }
                
                timeRangeRadios.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        selectedTimeRange = parseInt(e.target.value);
                        localStorage.setItem('timelineRange', selectedTimeRange.toString());
                        console.log('íƒ€ì„ë¼ì¸ ë²”ìœ„ ë³€ê²½:', selectedTimeRange, 'ì´ˆ');
                        
                        // ì°¨íŠ¸ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                        if (currentData && currentData.targets) {
                            updateComparisonChart(currentData.targets);
                        }
                    });
                });
            }

            // Timeline Minimize Button
            const timelineMinimizeBtn = document.getElementById('timelineMinimizeBtn');
            const timelineContent = document.getElementById('timelineContent');
            if (timelineMinimizeBtn && timelineContent) {
                timelineMinimizeBtn.addEventListener('click', () => {
                    const isCollapsed = timelineContent.classList.toggle('collapsed');
                    timelineMinimizeBtn.classList.toggle('minimized', isCollapsed);
                    
                    // ìƒíƒœ ì €ì¥
                    localStorage.setItem('timelineCollapsed', isCollapsed ? '1' : '0');
                });
                
                // ì €ì¥ëœ ìƒíƒœ ë³µì›
                if (localStorage.getItem('timelineCollapsed') === '1') {
                    timelineContent.classList.add('collapsed');
                    timelineMinimizeBtn.classList.add('minimized');
                }
            }

            // Minimized Area Minimize Button
            const minimizedAreaMinimizeBtn = document.getElementById('minimizedAreaMinimizeBtn');
            const minimizedAreaContent = document.getElementById('minimizedAreaContent');
            if (minimizedAreaMinimizeBtn && minimizedAreaContent) {
                minimizedAreaMinimizeBtn.addEventListener('click', () => {
                    const isCollapsed = minimizedAreaContent.classList.toggle('collapsed');
                    minimizedAreaMinimizeBtn.classList.toggle('minimized', isCollapsed);
                    
                    // ìƒíƒœ ì €ì¥
                    localStorage.setItem('minimizedAreaCollapsed', isCollapsed ? '1' : '0');
                });
                
                // ì €ì¥ëœ ìƒíƒœ ë³µì›
                if (localStorage.getItem('minimizedAreaCollapsed') === '1') {
                    minimizedAreaContent.classList.add('collapsed');
                    minimizedAreaMinimizeBtn.classList.add('minimized');
                }
            }

            // Control Buttons
            const toggleBtn = document.getElementById('toggleBtn');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    isRunning = !isRunning;
                    toggleBtn.textContent = isRunning ? 'ì¼ì‹œì •ì§€' : 'ì‹œì‘';
                    toggleBtn.className = isRunning ? 'btn btn-primary' : 'btn btn-success';
                    
                    if (isRunning) {
                        startUpdates();
                        if (pausedTime > 0) {
                            const pauseDuration = Date.now() - pausedTime;
                            startTime += pauseDuration;
                            pausedTime = 0;
                        }
                    } else {
                        stopUpdates();
                        pausedTime = Date.now();
                    }
                });
            }

            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const originalText = refreshBtn.textContent;
                    
                    try {
                        refreshBtn.textContent = 'ìƒˆë¡œê³ ì¹¨ ì¤‘...';
                        refreshBtn.disabled = true;
                        
                        startTime = Date.now();
                        pausedTime = 0;
                        pausedElapsed = 0;
                        updateTime();
                        
                        // í™•ì¥ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™” (v2.7)
                        extendedHistory = {};
                        
                        if (comparisonChart) {
                            comparisonChart.data.labels = [];
                            comparisonChart.data.datasets = [];
                            comparisonChart.update();
                        }
                        
                        Object.keys(ipCharts).forEach(key => {
                            if (ipCharts[key]) {
                                ipCharts[key].destroy();
                            }
                        });
                        ipCharts = {};
                        
                        const ipCardsContainer = document.getElementById('ipCardsContainer');
                        if (ipCardsContainer) {
                            ipCardsContainer.innerHTML = '';
                        }
                        
                        const minimizedCardsContainer = document.getElementById('minimizedCardsContainer');
                        if (minimizedCardsContainer) {
                            minimizedCardsContainer.innerHTML = '';
                        }
                        const minimizedCardsArea = document.getElementById('minimizedCardsArea');
                        if (minimizedCardsArea) {
                            minimizedCardsArea.style.display = 'none';
                        }
                        
                        await loadData();
                        
                        const notificationTab = document.getElementById('notifications');
                        if (notificationTab && notificationTab.classList.contains('active')) {
                            await loadNotifications();
                        }
                    } catch (error) {
                        console.error('ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                    } finally {
                        refreshBtn.textContent = originalText;
                        refreshBtn.disabled = false;
                    }
                });
            }

            // Sort Buttons
            const sortByName = document.getElementById('sortByName');
            const sortByLatency = document.getElementById('sortByLatency');
            const sortByStatus = document.getElementById('sortByStatus');
            
            if (sortByName) sortByName.addEventListener('click', () => sortIPCards('name'));
            if (sortByLatency) sortByLatency.addEventListener('click', () => sortIPCards('latency'));
            if (sortByStatus) sortByStatus.addEventListener('click', () => sortIPCards('status'));

            // Modal Buttons
            const modalCloseBtn = document.getElementById('modalClose');
            const detailModal = document.getElementById('detailModal');
            
            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', closeDetailModal);
            }
            
            if (detailModal) {
                detailModal.addEventListener('click', (e) => {
                    if (e.target.id === 'detailModal') {
                        closeDetailModal();
                    }
                });
            }

            // Tab Buttons
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    btn.classList.add('active');
                    const targetId = btn.getAttribute('data-tab');
                    const targetContent = document.getElementById(targetId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                    
                    if (targetId === 'notifications') {
                        loadNotifications();
                    } else if (targetId === 'outages') {
                        loadOutages();
                    }
                });
            });

            // Notification Filter Buttons
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.getAttribute('data-filter');
                    renderNotifications();
                });
            });

            // Chart Settings Modal
            const chartSettingsBtn = document.getElementById('chartSettingsBtn');
            const chartSettingsModal = document.getElementById('chartSettingsModal');
            const closeChartSettings = document.getElementById('closeChartSettings');
            const selectAllIPs = document.getElementById('selectAllIPs');
            const deselectAllIPs = document.getElementById('deselectAllIPs');
            const saveChartSettings = document.getElementById('saveChartSettings');

            if (chartSettingsBtn) {
                chartSettingsBtn.addEventListener('click', () => {
                    openChartSettings();
                });
            }

            if (closeChartSettings) {
                closeChartSettings.addEventListener('click', () => {
                    chartSettingsModal.classList.remove('active');
                });
            }

            if (chartSettingsModal) {
                chartSettingsModal.addEventListener('click', (e) => {
                    if (e.target.id === 'chartSettingsModal') {
                        chartSettingsModal.classList.remove('active');
                    }
                });
            }

            if (selectAllIPs) {
                selectAllIPs.addEventListener('click', () => {
                    selectAllIPsForChart();
                });
            }

            if (deselectAllIPs) {
                deselectAllIPs.addEventListener('click', () => {
                    deselectAllIPsForChart();
                });
            }

            if (saveChartSettings) {
                saveChartSettings.addEventListener('click', () => {
                    saveVisibleIPsState();
                    chartSettingsModal.classList.remove('active');
                });
            }
        }

        // Load saved header state

        // Save visible IPs state
        function saveVisibleIPsState() {
            const visibleArray = Array.from(visibleIPs);
            localStorage.setItem('visibleIPs', JSON.stringify(visibleArray));
            console.log('í•„í„° ì„¤ì • ì €ì¥:', visibleArray);
        }

        // Load visible IPs state
        function loadVisibleIPsState() {
            const saved = localStorage.getItem('visibleIPs');
            if (saved) {
                try {
                    const visibleArray = JSON.parse(saved);
                    visibleIPs = new Set(visibleArray);
                    console.log('í•„í„° ì„¤ì • ë¡œë“œ:', visibleArray);
                    return true;
                } catch (e) {
                    console.error('í•„í„° ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', e);
                }
            }
            return false;
        }

        // Save minimized state
        function saveMinimizedState() {
            const minimizedCards = document.querySelectorAll('.ip-card.minimized');
            const minimizedIndices = Array.from(minimizedCards).map(card => card.dataset.index);
            localStorage.setItem('minimizedCards', JSON.stringify(minimizedIndices));
            console.log('ìµœì†Œí™” ìƒíƒœ ì €ì¥:', minimizedIndices);
        }

        // Load minimized state
        function loadMinimizedState() {
            const saved = localStorage.getItem('minimizedCards');
            if (saved) {
                try {
                    const minimizedIndices = JSON.parse(saved);
                    console.log('ìµœì†Œí™” ìƒíƒœ ë¡œë“œ:', minimizedIndices);
                    
                    setTimeout(() => {
                        minimizedIndices.forEach(index => {
                            const card = document.getElementById(`ip-card-${index}`);
                            if (card && !card.classList.contains('minimized')) {
                                toggleMinimize(parseInt(index));
                            }
                        });
                    }, 100);
                } catch (e) {
                    console.error('ìµœì†Œí™” ìƒíƒœ ë¡œë“œ ì‹¤íŒ¨:', e);
                }
            }
        }

        // Time Update Functions
        function updateTime() {
            const now = new Date();
            
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}:${seconds}`;
            
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            document.getElementById('currentDate').textContent = `${year}-${month}-${day}`;
            
            let elapsed;
            if (!isRunning && pausedTime > 0) {
                elapsed = Math.floor((pausedTime - startTime) / 1000);
            } else {
                elapsed = Math.floor((Date.now() - startTime) / 1000);
            }
            
            const uptimeHours = Math.floor(elapsed / 3600);
            const uptimeMinutes = Math.floor((elapsed % 3600) / 60);
            const uptimeSeconds = elapsed % 60;
            document.getElementById('uptime').textContent = 
                `${String(uptimeHours).padStart(2, '0')}:${String(uptimeMinutes).padStart(2, '0')}:${String(uptimeSeconds).padStart(2, '0')}`;
        }

        // Initialize Charts
        function initComparisonChart() {
            const ctx = document.getElementById('comparisonChart');
            comparisonChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: { color: '#e4e6eb' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#3a3f5c' },
                            ticks: { color: '#b0b3b8' }
                        },
                        x: {
                            grid: { color: '#3a3f5c' },
                            ticks: { color: '#b0b3b8' }
                        }
                    }
                }
            });
        }

        function createIPChart(canvasId, index) {
            const ctx = document.getElementById(canvasId);
            const color = brightColors[index % brightColors.length];
            
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(60).fill(''),
                    datasets: [{
                        label: 'Latency (ms)',
                        data: [],
                        borderColor: color,
                        backgroundColor: color + '30',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#3a3f5c' },
                            ticks: { color: '#b0b3b8' }
                        },
                        x: {
                            display: false
                        }
                    }
                }
            });
        }

        // Load Data
        async function loadData() {
            try {
                const response = await fetch('/data/ping_data.json?t=' + Date.now());
                const data = await response.json();
                currentData = data;
                updateUI(data);
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // Update UI
        function updateUI(data) {
            if (!data || !data.targets) return;

            // ì €ì¥ëœ í•„í„° ìƒíƒœ ë¡œë“œ ë˜ëŠ” ì´ˆê¸°í™”
            if (visibleIPs.size === 0) {
                const loaded = loadVisibleIPsState();
                if (!loaded) {
                    data.targets.forEach((_, index) => visibleIPs.add(index));
                }
            }

            // Update global stats
            const onlineCount = data.targets.filter(t => t.online).length;
            const offlineCount = data.targets.length - onlineCount;
            const avgLatency = Math.round(
                data.targets.reduce((sum, t) => sum + (t.online ? t.latency : 0), 0) / 
                (onlineCount || 1)
            );

            document.getElementById('totalIPs').textContent = data.targets.length;
            document.getElementById('onlineCount').textContent = onlineCount;
            document.getElementById('offlineCount').textContent = offlineCount;
            document.getElementById('avgLatency').textContent = avgLatency + ' ms';

            // Update comparison chart
            updateComparisonChart(data.targets);

            // Update IP cards
            updateIPCards(data.targets);
            
            // Load minimized state (only first time)
            if (Object.keys(ipCharts).length === data.targets.length) {
                loadMinimizedState();
            }
            
            // Update modal if open
            updateModalIfOpen();
        }

        // Update Comparison Chart (v2.7 - Extended Timeline Support)
        function updateComparisonChart(targets) {
            // í™•ì¥ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
            targets.forEach(target => {
                const key = target.ip;
                if (!extendedHistory[key]) {
                    extendedHistory[key] = [];
                }
                
                // ìµœì‹  latency ê°’ ì¶”ê°€ (ì´ˆë‹¹ 1ê°œ)
                const currentLatency = target.online ? target.latency : 0;
                extendedHistory[key].push(currentLatency);
                
                // ìµœëŒ€ í¬ì¸íŠ¸ ìˆ˜ ì œí•œ
                if (extendedHistory[key].length > MAX_HISTORY_POINTS) {
                    extendedHistory[key].shift();
                }
            });
            
            // ì‹œê°„ ë²”ìœ„ì— ë”°ë¥¸ ë ˆì´ë¸” ìƒì„±
            const labels = generateTimeLabels(selectedTimeRange);
            comparisonChart.data.labels = labels;
            
            const filteredTargets = targets.filter((target, index) => visibleIPs.has(index));
            
            comparisonChart.data.datasets = filteredTargets.map((target) => {
                const originalIndex = targets.findIndex(t => t.ip === target.ip && t.name === target.name);
                const key = target.ip;
                
                // í™•ì¥ íˆìŠ¤í† ë¦¬ì—ì„œ í•„ìš”í•œ ë²”ìœ„ë§Œ ê°€ì ¸ì˜¤ê¸°
                const history = extendedHistory[key] || [];
                const displayData = getDisplayData(history, selectedTimeRange);
                
                return {
                    label: target.name,
                    data: displayData,
                    borderColor: brightColors[originalIndex % brightColors.length],
                    backgroundColor: brightColors[originalIndex % brightColors.length] + '20',
                    tension: 0.4,
                    borderWidth: 2,
                    fill: false,
                    pointRadius: selectedTimeRange <= 300 ? 2 : 0,  // 5ë¶„ ì´í•˜ë©´ ì  í‘œì‹œ
                    pointHoverRadius: 4
                };
            });
            
            comparisonChart.update();
        }
        
        // ì‹œê°„ ë²”ìœ„ì— ë”°ë¥¸ ë ˆì´ë¸” ìƒì„± (v2.7)
        function generateTimeLabels(timeRangeSeconds) {
            const totalPoints = Math.min(60, timeRangeSeconds);  // ìµœëŒ€ 60ê°œ í¬ì¸íŠ¸
            const interval = timeRangeSeconds / totalPoints;
            const labels = [];
            
            for (let i = totalPoints; i >= 1; i--) {
                const secondsAgo = Math.round(i * interval);
                
                if (timeRangeSeconds <= 60) {
                    // 1ë¶„: ì´ˆ ë‹¨ìœ„
                    labels.push(secondsAgo + 'ì´ˆ');
                } else if (timeRangeSeconds <= 3600) {
                    // 1ì‹œê°„ ì´í•˜: ë¶„:ì´ˆ
                    const mins = Math.floor(secondsAgo / 60);
                    const secs = secondsAgo % 60;
                    if (secs === 0) {
                        labels.push(mins + 'ë¶„');
                    } else {
                        labels.push(mins + ':' + String(secs).padStart(2, '0'));
                    }
                } else {
                    // 1ì‹œê°„ ì´ˆê³¼: ì‹œ:ë¶„
                    const hours = Math.floor(secondsAgo / 3600);
                    const mins = Math.floor((secondsAgo % 3600) / 60);
                    if (hours > 0) {
                        labels.push(hours + 'ì‹œê°„ ' + mins + 'ë¶„');
                    } else {
                        labels.push(mins + 'ë¶„');
                    }
                }
            }
            
            return labels;
        }
        
        // í™•ì¥ íˆìŠ¤í† ë¦¬ì—ì„œ í‘œì‹œí•  ë°ì´í„° ì¶”ì¶œ (v2.7)
        function getDisplayData(history, timeRangeSeconds) {
            const totalPoints = Math.min(60, timeRangeSeconds);  // ìµœëŒ€ 60ê°œ í¬ì¸íŠ¸
            const interval = Math.floor(timeRangeSeconds / totalPoints);
            
            // í•„ìš”í•œ ë°ì´í„° í¬ì¸íŠ¸ ìˆ˜
            const neededPoints = timeRangeSeconds;
            
            // íˆìŠ¤í† ë¦¬ê°€ ì¶©ë¶„í•˜ì§€ ì•Šìœ¼ë©´ ìˆëŠ” ë§Œí¼ë§Œ ì‚¬ìš©
            const availableHistory = history.slice(-neededPoints);
            
            if (availableHistory.length === 0) {
                return Array(totalPoints).fill(null);
            }
            
            // ìƒ˜í”Œë§í•˜ì—¬ 60ê°œ ì´í•˜ì˜ í¬ì¸íŠ¸ë¡œ ì¤„ì´ê¸°
            const result = [];
            for (let i = 0; i < totalPoints; i++) {
                const startIdx = Math.floor(i * interval);
                const endIdx = Math.min(startIdx + interval, availableHistory.length);
                
                if (startIdx < availableHistory.length) {
                    // í•´ë‹¹ êµ¬ê°„ì˜ í‰ê· ê°’ ê³„ì‚°
                    const slice = availableHistory.slice(startIdx, endIdx);
                    const validValues = slice.filter(v => v !== null && v !== undefined && v > 0);
                    
                    if (validValues.length > 0) {
                        const avg = validValues.reduce((a, b) => a + b, 0) / validValues.length;
                        result.push(Math.round(avg));
                    } else {
                        result.push(null);
                    }
                } else {
                    result.push(null);
                }
            }
            
            return result;
        }

        // Chart Settings Functions
        function openChartSettings() {
            if (!currentData || !currentData.targets) return;
            
            populateIPCheckboxList(currentData.targets);
            document.getElementById('chartSettingsModal').classList.add('active');
        }

        function populateIPCheckboxList(targets) {
            const listContainer = document.getElementById('ipCheckboxList');
            listContainer.innerHTML = '';

            targets.forEach((target, index) => {
                const item = document.createElement('div');
                item.className = 'ip-checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `ip-check-${index}`;
                checkbox.checked = visibleIPs.has(index);
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        visibleIPs.add(index);
                    } else {
                        visibleIPs.delete(index);
                    }
                    updateComparisonChart(targets);
                });

                const label = document.createElement('label');
                label.className = 'ip-checkbox-label';
                label.htmlFor = `ip-check-${index}`;
                
                const colorBox = document.createElement('div');
                colorBox.className = 'ip-checkbox-color';
                colorBox.style.backgroundColor = brightColors[index % brightColors.length];
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'ip-checkbox-name';
                nameSpan.textContent = target.name;
                
                const ipSpan = document.createElement('span');
                ipSpan.className = 'ip-checkbox-ip';
                ipSpan.textContent = target.ip;
                
                label.appendChild(colorBox);
                label.appendChild(nameSpan);
                label.appendChild(ipSpan);
                
                item.appendChild(checkbox);
                item.appendChild(label);
                listContainer.appendChild(item);
            });
        }

        function selectAllIPsForChart() {
            if (!currentData || !currentData.targets) return;
            
            currentData.targets.forEach((_, index) => {
                visibleIPs.add(index);
                const checkbox = document.getElementById(`ip-check-${index}`);
                if (checkbox) checkbox.checked = true;
            });
            
            updateComparisonChart(currentData.targets);
        }

        function deselectAllIPsForChart() {
            if (!currentData || !currentData.targets) return;
            
            visibleIPs.clear();
            currentData.targets.forEach((_, index) => {
                const checkbox = document.getElementById(`ip-check-${index}`);
                if (checkbox) checkbox.checked = false;
            });
            
            updateComparisonChart(currentData.targets);
        }

        // Update IP Cards
        function updateIPCards(targets) {
            const container = document.getElementById('ipCardsContainer');
            
            targets.forEach((target, index) => {
                let card = document.getElementById(`ip-card-${index}`);
                
                if (!card) {
                    card = createIPCard(target, index);
                    container.appendChild(card);
                    ipCharts[index] = createIPChart(`chart-${index}`, index);
                }
                
                updateIPCard(card, target, index);
            });
        }

        // Create IP Card
        function createIPCard(target, index) {
            const card = document.createElement('div');
            card.id = `ip-card-${index}`;
            card.className = 'ip-card';
            card.draggable = true;
            card.dataset.index = index;
            
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragover', handleDragOver);
            card.addEventListener('drop', handleDrop);
            card.addEventListener('dragend', handleDragEnd);
            
            card.innerHTML = `
                <div class="ip-header">
                    <div>
                        <div class="ip-name">${target.name}</div>
                        <div class="ip-address">${target.ip}</div>
                    </div>
                    <div class="card-actions">
                        <button class="card-action-btn card-minimize-btn" onclick="toggleMinimize(${index})" title="ìµœì†Œí™”">âˆ’</button>
                        <button class="card-action-btn card-restore-btn" onclick="toggleMinimize(${index})" title="ë³µì›">+</button>
                        <button class="card-action-btn card-expand-btn" onclick="openDetailModal(${index})" title="ìƒì„¸ë³´ê¸°">âŠ•</button>
                    </div>
                </div>
                <span class="status-badge" id="status-${index}">ì˜¤í”„ë¼ì¸</span>
                <div class="chart-container">
                    <canvas id="chart-${index}"></canvas>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-item-label">ì§€ì—°ì‹œê°„</div>
                        <div class="stat-item-value" id="latency-${index}">0 ms</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">ìµœì†Œ</div>
                        <div class="stat-item-value" id="min-${index}">0 ms</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">í‰ê· </div>
                        <div class="stat-item-value" id="avg-${index}">0 ms</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">ìµœëŒ€</div>
                        <div class="stat-item-value" id="max-${index}">0 ms</div>
                    </div>
                </div>
                <div class="packet-bars" id="packets-${index}"></div>
            `;
            return card;
        }

        // Drag & Drop Handlers
        function handleDragStart(e) {
            draggedElement = this;
            draggedIndex = parseInt(this.dataset.index);
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedElement !== this) {
                const container = document.getElementById('ipCardsContainer');
                const allCards = [...container.children];
                const draggedPos = allCards.indexOf(draggedElement);
                const targetPos = allCards.indexOf(this);
                
                if (draggedPos < targetPos) {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedElement, this);
                }
            }
            
            return false;
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            draggedElement = null;
            draggedIndex = null;
        }

        // Sort Functions
        function sortIPCards(sortBy) {
            if (!currentData || !currentData.targets) return;
            
            const container = document.getElementById('ipCardsContainer');
            const cards = [...container.children];
            
            const targets = currentData.targets.map((target, index) => ({
                target,
                index,
                card: cards[index]
            }));
            
            targets.sort((a, b) => {
                switch(sortBy) {
                    case 'name':
                        return a.target.name.localeCompare(b.target.name);
                    case 'latency':
                        return b.target.latency - a.target.latency;
                    case 'status':
                        return b.target.online - a.target.online;
                    default:
                        return 0;
                }
            });
            
            container.innerHTML = '';
            targets.forEach(item => {
                container.appendChild(item.card);
            });
        }

        // Toggle Minimize
        function toggleMinimize(index) {
            const card = document.getElementById(`ip-card-${index}`);
            
            if (!card) return;
            
            const isMinimized = card.classList.contains('minimized');
            const ipCardsContainer = document.getElementById('ipCardsContainer');
            const minimizedCardsContainer = document.getElementById('minimizedCardsContainer');
            const minimizedCardsArea = document.getElementById('minimizedCardsArea');
            
            if (isMinimized) {
                card.classList.remove('minimized');
                card.draggable = true;
                ipCardsContainer.appendChild(card);
            } else {
                card.classList.add('minimized');
                card.draggable = false;
                minimizedCardsContainer.appendChild(card);
            }
            
            updateMinimizedArea();
            saveMinimizedState();
        }

        // Update Minimized Area
        function updateMinimizedArea() {
            const minimizedCardsContainer = document.getElementById('minimizedCardsContainer');
            const minimizedCardsArea = document.getElementById('minimizedCardsArea');
            const minimizedCount = document.getElementById('minimizedCount');
            
            const count = minimizedCardsContainer.children.length;
            
            if (count > 0) {
                minimizedCardsArea.style.display = 'block';
            } else {
                minimizedCardsArea.style.display = 'none';
            }
            
            minimizedCount.textContent = count;
        }

        // Open Detail Modal
        function openDetailModal(index) {
            if (!currentData || !currentData.targets[index]) return;
            
            const target = currentData.targets[index];
            currentModalTarget = index;
            
            document.getElementById('modalTitle').textContent = target.name;
            document.getElementById('modalSubtitle').textContent = target.ip;
            
            document.getElementById('modalLatency').textContent = target.latency + ' ms';
            document.getElementById('modalMin').textContent = target.min + ' ms';
            document.getElementById('modalAvg').textContent = Math.round(target.avg) + ' ms';
            document.getElementById('modalMax').textContent = target.max + ' ms';
            
            const lossRate = target.total > 0 ? ((target.failed / target.total) * 100).toFixed(1) : 0;
            document.getElementById('modalLoss').textContent = lossRate + '%';
            document.getElementById('modalStatus').textContent = target.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
            document.getElementById('modalStatus').style.color = target.online ? 'var(--success)' : 'var(--error)';
            
            document.getElementById('modalTotal').textContent = target.total;
            document.getElementById('modalSuccess').textContent = target.total - target.failed;
            document.getElementById('modalFailed').textContent = target.failed;
            
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
            document.getElementById('modalLastResponse').textContent = target.online ? timeStr : 'ì‘ë‹µ ì—†ìŒ';
            
            createModalChart(target, index);
            
            document.getElementById('detailModal').classList.add('active');
        }

        // Close Detail Modal
        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
            if (modalChart) {
                modalChart.destroy();
                modalChart = null;
            }
            currentModalTarget = null;
        }

        // Create Modal Chart
        function createModalChart(target, index) {
            if (modalChart) {
                modalChart.destroy();
            }
            
            const ctx = document.getElementById('modalChart');
            const color = brightColors[index % brightColors.length];
            
            const now = new Date();
            const labels = Array(60).fill('').map((_, i) => {
                const time = new Date(now.getTime() - (59 - i) * 1000);
                return `${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}:${String(time.getSeconds()).padStart(2, '0')}`;
            });
            
            modalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì§€ì—°ì‹œê°„ (ms)',
                        data: target.history,
                        borderColor: color,
                        backgroundColor: color + '30',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3,
                        pointRadius: 1,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: { 
                                color: '#e4e6eb', 
                                font: { size: 12 },
                                padding: 10
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 12 },
                            bodyFont: { size: 11 },
                            padding: 8
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#3a3f5c' },
                            ticks: { 
                                color: '#b0b3b8',
                                font: { size: 11 }
                            }
                        },
                        x: {
                            grid: { color: '#3a3f5c' },
                            ticks: { 
                                color: '#b0b3b8',
                                font: { size: 9 },
                                maxRotation: 45,
                                minRotation: 45,
                                autoSkip: true,
                                maxTicksLimit: 12
                            }
                        }
                    }
                }
            });
        }

        // Update Modal if Open
        function updateModalIfOpen() {
            if (currentModalTarget !== null && currentData && currentData.targets[currentModalTarget]) {
                const target = currentData.targets[currentModalTarget];
                
                document.getElementById('modalLatency').textContent = target.latency + ' ms';
                document.getElementById('modalMin').textContent = target.min + ' ms';
                document.getElementById('modalAvg').textContent = Math.round(target.avg) + ' ms';
                document.getElementById('modalMax').textContent = target.max + ' ms';
                
                const lossRate = target.total > 0 ? ((target.failed / target.total) * 100).toFixed(1) : 0;
                document.getElementById('modalLoss').textContent = lossRate + '%';
                document.getElementById('modalStatus').textContent = target.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
                document.getElementById('modalStatus').style.color = target.online ? 'var(--success)' : 'var(--error)';
                
                document.getElementById('modalTotal').textContent = target.total;
                document.getElementById('modalSuccess').textContent = target.total - target.failed;
                document.getElementById('modalFailed').textContent = target.failed;
                
                if (modalChart) {
                    const now = new Date();
                    const labels = Array(60).fill('').map((_, i) => {
                        const time = new Date(now.getTime() - (59 - i) * 1000);
                        return `${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}:${String(time.getSeconds()).padStart(2, '0')}`;
                    });
                    
                    modalChart.data.labels = labels;
                    modalChart.data.datasets[0].data = target.history;
                    modalChart.update();
                }
                
                const now = new Date();
                const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                document.getElementById('modalLastResponse').textContent = target.online ? timeStr : 'ì‘ë‹µ ì—†ìŒ';
            }
        }

        // Update IP Card
        function updateIPCard(card, target, index) {
            const statusBadge = card.querySelector(`#status-${index}`);
            if (statusBadge) {
                statusBadge.textContent = target.online ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸';
                statusBadge.className = target.online ? 'status-badge status-online' : 'status-badge status-offline';
            }

            const latencyEl = document.getElementById(`latency-${index}`);
            if (latencyEl) latencyEl.textContent = target.latency + ' ms';
            
            const minEl = document.getElementById(`min-${index}`);
            if (minEl) minEl.textContent = target.min + ' ms';
            
            const avgEl = document.getElementById(`avg-${index}`);
            if (avgEl) avgEl.textContent = Math.round(target.avg) + ' ms';
            
            const maxEl = document.getElementById(`max-${index}`);
            if (maxEl) maxEl.textContent = target.max + ' ms';

            if (ipCharts[index] && !card.classList.contains('minimized')) {
                ipCharts[index].data.datasets[0].data = target.history;
                ipCharts[index].update();
            }

            const packetsContainer = document.getElementById(`packets-${index}`);
            if (packetsContainer) {
                packetsContainer.innerHTML = target.history.map(latency => {
                    const className = latency > 0 ? 'packet-bar packet-success' : 'packet-bar packet-fail';
                    return `<div class="${className}"></div>`;
                }).join('');
            }
        }

        // Load Notifications
        async function loadNotifications() {
            try {
                const response = await fetch('/data/notification_log.json?t=' + Date.now());
                if (!response.ok) {
                    showEmptyNotifications();
                    return;
                }
                
                const logs = await response.json();
                allNotifications = logs.reverse();
                
                updateNotificationStats();
                renderNotifications();
            } catch (error) {
                console.error('ì•Œë¦¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                showEmptyNotifications();
            }
        }

        // Update Notification Stats
        function updateNotificationStats() {
            const total = allNotifications.length;
            const timeouts = allNotifications.filter(n => n.type === 'timeout').length;
            const recoveries = allNotifications.filter(n => n.type === 'recovery').length;

            document.getElementById('notifTotalCount').textContent = total;
            document.getElementById('notifTimeoutCount').textContent = timeouts;
            document.getElementById('notifRecoveryCount').textContent = recoveries;
        }

        // Render Notifications
        function renderNotifications() {
            const container = document.getElementById('notificationList');
            
            const filtered = currentFilter === 'all' 
                ? allNotifications 
                : allNotifications.filter(n => n.type === currentFilter);

            if (filtered.length === 0) {
                showEmptyNotifications();
                return;
            }

            container.innerHTML = filtered.map(notif => `
                <div class="notification-item ${notif.type}">
                    <div class="notification-header">
                        <span class="notification-type ${notif.type}">
                            ${notif.type === 'timeout' ? 'âš ï¸ íƒ€ì„ì•„ì›ƒ' : 'âœ… ë³µêµ¬'}
                        </span>
                        <span class="notification-time">${notif.date} ${notif.time}</span>
                    </div>
                    <div class="notification-name">${notif.name}</div>
                    <div class="notification-ip">${notif.ip}</div>
                </div>
            `).join('');
        }

        // Show Empty Notifications
        function showEmptyNotifications() {
            const container = document.getElementById('notificationList');
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“­</div>
                    <div>ì•„ì§ ì•Œë¦¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            `;
        }

        // Update Loop
        function startUpdates() {
            updateInterval = setInterval(() => {
                loadData();
            }, 1000);
        }

        function stopUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        }

        // Outage Management Functions (v2.6)
        async function loadOutages() {
            try {
                const response = await fetch('/data/outage_log.json?t=' + Date.now());
                const data = await response.json();
                allOutages = data.outages || [];
                renderOutages();
            } catch (error) {
                console.error('ì¥ì•  ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('outageList').innerHTML = '<div class="no-outages">ì¥ì•  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        function renderOutages() {
            const container = document.getElementById('outageList');
            
            let filtered = allOutages.filter(o => {
                const statusMatch = currentOutageFilter.status === 'all' || o.status === currentOutageFilter.status;
                const groupMatch = currentOutageFilter.group === 'all' || o.group === currentOutageFilter.group;
                return statusMatch && groupMatch;
            });

            filtered.sort((a, b) => new Date(b.start_time) - new Date(a.start_time));

            if (filtered.length === 0) {
                container.innerHTML = '<div class="no-outages">ì¥ì•  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            container.innerHTML = filtered.map(outage => {
                let downtimeStr;
                if (outage.status === 'ongoing') {
                    const now = new Date();
                    const start = new Date(outage.start_time);
                    const seconds = Math.floor((now - start) / 1000);
                    downtimeStr = formatDuration(seconds) + ' (ì§„í–‰ ì¤‘)';
                } else {
                    downtimeStr = formatDuration(outage.downtime_seconds);
                }

                return `
                    <div class="outage-card ${outage.status}">
                        <div class="outage-header">
                            <span class="outage-status-badge ${outage.status}">
                                ${outage.status === 'ongoing' ? 'ğŸ”´ ì§„í–‰ì¤‘' : 'ğŸŸ¢ ë³µêµ¬ë¨'}
                            </span>
                            <span class="priority priority-${outage.priority}">P${outage.priority}</span>
                        </div>
                        <div class="outage-info">
                            <h3>${outage.name}</h3>
                            <p class="ip">${outage.ip}</p>
                            <p class="group">ê·¸ë£¹: ${outage.group}</p>
                        </div>
                        <div class="outage-timeline">
                            <div class="timeline-item">
                                <span class="label">ì‹œì‘:</span>
                                <span class="time">${formatTime(outage.start_time)}</span>
                            </div>
                            ${outage.end_time ? `
                            <div class="timeline-item">
                                <span class="label">ì¢…ë£Œ:</span>
                                <span class="time">${formatTime(outage.end_time)}</span>
                            </div>
                            ` : ''}
                            <div class="timeline-item">
                                <span class="label">ë‹¤ìš´íƒ€ì„:</span>
                                <span class="time">${downtimeStr}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatDuration(seconds) {
            if (!seconds) return '0ì´ˆ';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (hours > 0) {
                return `${hours}ì‹œê°„ ${minutes}ë¶„`;
            } else if (minutes > 0) {
                return `${minutes}ë¶„ ${secs}ì´ˆ`;
            } else {
                return `${secs}ì´ˆ`;
            }
        }

        function formatTime(timeStr) {
            if (!timeStr) return 'N/A';
            const date = new Date(timeStr);
            return date.toLocaleString('ko-KR');
        }

        // ========================================================================
        // Settings Tabs Event Listeners (v2.6)
        // ========================================================================
        
        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing settings tabs...');
            
            const tabButtons = document.querySelectorAll('.settings-tab-btn');
            console.log('Found tab buttons:', tabButtons.length);
            
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const tabId = this.getAttribute('data-settings-tab');
                    console.log('Tab clicked:', tabId);
                    
                    // Remove active class from all buttons
                    tabButtons.forEach(b => b.classList.remove('active'));
                    
                    // Add active to clicked button
                    this.classList.add('active');
                    
                    // Hide all tab contents
                    document.querySelectorAll('.settings-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show target tab content
                    const targetTab = document.getElementById('settings-' + tabId);
                    if (targetTab) {
                        targetTab.classList.add('active');
                        console.log('Activated tab:', 'settings-' + tabId);
                    } else {
                        console.error('Tab not found:', 'settings-' + tabId);
                    }
                    
                    // Load data for specific tabs
                    if (tabId === 'thresholds') {
                        // Show loading state initially
                        const emptyState = document.getElementById('thresholdEmptyState');
                        const contentDiv = document.getElementById('thresholdContent');
                        if (emptyState) emptyState.style.display = 'block';
                        if (contentDiv) contentDiv.style.display = 'none';
                        
                        loadThresholdSettings();
                    } else if (tabId === 'ipgroups') {
                        // Show loading state initially
                        const emptyState = document.getElementById('ipgroupEmptyState');
                        const contentDiv = document.getElementById('ipgroupContent');
                        if (emptyState) emptyState.style.display = 'block';
                        if (contentDiv) contentDiv.style.display = 'none';
                        
                        loadIPConfigTable();
                    }
                });
            });
        });
        
        // Load threshold settings
        async function loadThresholdSettings() {
            const emptyState = document.getElementById('thresholdEmptyState');
            const contentDiv = document.getElementById('thresholdContent');
            
            try {
                const response = await fetch('/config/ping_config.ini?t=' + Date.now());
                const text = await response.text();
                
                // Parse [OutageDetection] section
                const outageRegex = /\[OutageDetection\]([\s\S]*?)(?:\[|$)/;
                const match = text.match(outageRegex);
                
                if (match) {
                    const section = match[1];
                    
                    const parseValue = (key) => {
                        const regex = new RegExp(key + '\s*=\s*(\d+)');
                        const m = section.match(regex);
                        return m ? parseInt(m[1]) : null;
                    };
                    
                    // Set default threshold
                    const defaultVal = parseValue('OutageThreshold');
                    if (defaultVal) {
                        const input = document.getElementById('defaultThreshold');
                        if (input) input.value = defaultVal;
                    }
                    
                    // Set group thresholds
                    const groups = {
                        'ì„œë²„': 'ServerOutageThreshold',
                        'ë„¤íŠ¸ì›Œí¬': 'NetworkOutageThreshold',
                        'ë°©í™”ë²½': 'FirewallOutageThreshold',
                        'ë°ì´í„°ë² ì´ìŠ¤': 'DatabaseOutageThreshold',
                        'ì›¹ì„œë²„': 'WebServerOutageThreshold',
                        'ìŠ¤í† ë¦¬ì§€': 'StorageOutageThreshold',
                        'ê¸°íƒ€': 'OtherOutageThreshold'
                    };
                    
                    for (const [groupName, key] of Object.entries(groups)) {
                        const value = parseValue(key);
                        if (value) {
                            const input = document.getElementById('thresh_' + groupName);
                            if (input) input.value = value;
                        }
                    }
                    
                    console.log('Threshold settings loaded');
                    
                    // Show content, hide empty state
                    if (emptyState) emptyState.style.display = 'none';
                    if (contentDiv) contentDiv.style.display = 'block';
                } else {
                    // No config found - show empty state
                    if (emptyState) emptyState.style.display = 'block';
                    if (contentDiv) contentDiv.style.display = 'none';
                }
            } catch (error) {
                console.error('Failed to load threshold settings:', error);
                // Show empty state on error
                if (emptyState) emptyState.style.display = 'block';
                if (contentDiv) contentDiv.style.display = 'none';
            }
        }
        
        // Load IP configuration table
        function loadIPConfigTable() {
            const emptyState = document.getElementById('ipgroupEmptyState');
            const contentDiv = document.getElementById('ipgroupContent');
            const tbody = document.getElementById('ipConfigTableBody');
            
            if (!tbody) {
                console.error('ipConfigTableBody not found');
                return;
            }
            
            if (!currentData || !currentData.targets || currentData.targets.length === 0) {
                console.warn('No ping data available');
                // Show empty state
                if (emptyState) emptyState.style.display = 'block';
                if (contentDiv) contentDiv.style.display = 'none';
                return;
            }
            
            // Hide empty state, show content
            if (emptyState) emptyState.style.display = 'none';
            if (contentDiv) contentDiv.style.display = 'block';
            
            tbody.innerHTML = currentData.targets.map(target => `
                <tr>
                    <td style="font-family: 'Courier New', monospace;">${target.ip}</td>
                    <td>${target.name}</td>
                    <td>
                        <select data-ip="${target.ip}" class="ip-group-select">
                            <option value="ì„œë²„" ${(target.group === 'ì„œë²„' || target.group === 'Server') ? 'selected' : ''}>ğŸ–¥ï¸ ì„œë²„</option>
                            <option value="ë„¤íŠ¸ì›Œí¬" ${(target.group === 'ë„¤íŠ¸ì›Œí¬' || target.group === 'Network') ? 'selected' : ''}>ğŸŒ ë„¤íŠ¸ì›Œí¬</option>
                            <option value="ë°©í™”ë²½" ${(target.group === 'ë°©í™”ë²½' || target.group === 'Firewall') ? 'selected' : ''}>ğŸ›¡ï¸ ë°©í™”ë²½</option>
                            <option value="ë°ì´í„°ë² ì´ìŠ¤" ${target.group === 'ë°ì´í„°ë² ì´ìŠ¤' ? 'selected' : ''}>ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤</option>
                            <option value="ì›¹ì„œë²„" ${target.group === 'ì›¹ì„œë²„' ? 'selected' : ''}>ğŸŒ ì›¹ì„œë²„</option>
                            <option value="ìŠ¤í† ë¦¬ì§€" ${target.group === 'ìŠ¤í† ë¦¬ì§€' ? 'selected' : ''}>ğŸ“¦ ìŠ¤í† ë¦¬ì§€</option>
                            <option value="ê¸°íƒ€" ${(target.group === 'ê¸°íƒ€' || target.group === 'Other' || !target.group) ? 'selected' : ''}>ğŸ”§ ê¸°íƒ€</option>
                        </select>
                    </td>
                    <td>
                        <input type="number" min="1" max="5" value="${target.priority || 5}" 
                               data-ip="${target.ip}" class="ip-priority-input">
                    </td>
                </tr>
            `).join('');
            
            console.log('IP config table loaded with', currentData.targets.length, 'entries');
        }

    </script>

</body>
</html>